# 快速测试：商户库存税率继承

## 测试目标
验证商户入库时，产品的税务分类能够自动继承分类的默认税率。

## 测试环境
- 服务器地址：http://localhost:3000
- 管理员账号：admin / admin123
- 商户账号：merchant_001 / merchant123

## 测试步骤

### 步骤 1：配置分类税率（管理员）

1. 使用管理员账号登录：http://localhost:3000
2. 进入"系统设置"页面
3. 在"产品分类管理"部分：
   - 找到或添加分类：`Type-C Cable 1M`
   - 设置默认税率：`VAT 23%`
   - 点击"保存"或"添加分类"

### 步骤 2：商户入库（商户）

1. 退出管理员账号
2. 使用商户账号登录：merchant_001 / merchant123
3. 进入"我的库存"标签页
4. 点击"+ 手动入库"按钮
5. 填写入库信息：
   - 产品名称：`Type-C Cable 1M`
   - 分类：选择 `Type-C Cable 1M`（从下拉框选择）
   - 数量：`10`
   - 成本价：`2.00`
   - 批发价：`3.00`
   - 零售价：`5.00`
   - 其他字段可选填
6. 点击"确认入库"

### 步骤 3：验证税率继承

1. 入库成功后，在"我的库存"列表中查看
2. 找到刚才入库的产品
3. 检查"税务分类"列
4. **预期结果**：应该显示 `VAT 23%` 标签（蓝色徽章）

### 步骤 4：测试其他税率类型

重复步骤1-3，测试不同的税率：

**测试 Service VAT 13.5%：**
- 分类：`Phone Repair Service`
- 默认税率：`Service VAT 13.5%`
- 预期显示：`Service 13.5%` 标签（黄色徽章）

**测试 Margin VAT：**
- 分类：`Used iPhone`
- 默认税率：`Margin VAT`
- 预期显示：`Margin VAT` 标签（蓝色徽章）

## 验证点

✅ **税率自动继承**
- 入库时不需要手动选择税率
- 税率自动从分类配置中获取

✅ **正确显示**
- 库存列表中"税务分类"列显示正确的税率标签
- 标签颜色和文字符合预期

✅ **容错处理**
- 如果分类没有配置税率，使用默认值 `VAT 23%`
- 如果分类不存在，仍能正常入库

## 测试不同场景

### 场景 1：分类有默认税率
- 配置：Type-C Cable 1M → VAT 23%
- 结果：入库后显示 VAT 23%

### 场景 2：分类没有配置税率
- 配置：新分类，未设置默认税率
- 结果：入库后显示 VAT 23%（默认值）

### 场景 3：修改分类税率
- 配置：将 Type-C Cable 1M 的税率改为 Service VAT 13.5%
- 新入库：显示 Service 13.5%
- 已入库：仍显示 VAT 23%（不受影响）

## 常见问题

**Q: 修改分类的默认税率后，已入库的产品会更新吗？**
A: 不会。税率继承发生在入库时，修改分类税率只影响新入库的产品。

**Q: 如果分类不存在怎么办？**
A: 系统会使用默认税率 VAT 23%，并正常完成入库。

**Q: 可以手动修改已入库产品的税率吗？**
A: 当前版本不支持，需要删除后重新入库，或者通过数据库直接修改。

## 技术细节

### 税率格式转换
- `VAT 23%` → `VAT_23`
- `Service VAT 13.5%` → `SERVICE_VAT_13_5`
- `Margin VAT` → `MARGIN_VAT_0`

### API响应示例
```json
{
  "success": true,
  "data": {
    "inventoryId": "65abc123...",
    "taxClassification": "VAT_23",
    "message": "入库成功"
  }
}
```

## 相关文档
- [商户库存税率继承功能](./MERCHANT_INVENTORY_TAX_INHERITANCE.md)
- [商户库存功能实施进度](./MERCHANT_INVENTORY_IMPLEMENTATION_PROGRESS.md)
- [产品分类管理简化](./CATEGORY_MANAGEMENT_SIMPLIFIED.md)
