# ✅ 管理员系统设置功能

## 功能概述

为管理员添加了系统设置管理页面，用于管理产品分类、设备成色、税率等系统基础信息。

---

## 📋 功能列表

### 1. 产品分类管理

管理员可以：
- ✅ 查看所有产品分类
- ✅ 添加新的产品分类
- ✅ 编辑现有分类
- ✅ 删除分类（带保护机制）
- ✅ 设置分类的默认税率和成色
- ✅ 调整分类排序权重

#### 分类字段
- **分类名称**: 分类的显示名称
- **分类类型**: 预设的9种类型
  - 手机配件
  - 电脑配件
  - 车载配件
  - Audio
  - 数据线
  - Power Supply
  - 全新设备
  - 二手设备
  - 维修服务
- **描述**: 分类的详细说明
- **默认税率**: VAT 23% / VAT 13.5% / VAT 0%
- **默认成色**: Brand New / Pre-Owned / Refurbished
- **排序权重**: 数字越大越靠前
- **状态**: 启用/禁用

#### 删除保护机制
- 删除分类前会检查是否有产品使用该分类
- 如果有产品使用，会提示产品数量并阻止删除
- 管理员需要先将产品移动到其他分类，才能删除

### 2. 设备成色设置

显示系统预设的三种设备成色：
- **Brand New** (全新): 全新未拆封产品
- **Pre-Owned** (二手): 使用过的产品，功能正常
- **Refurbished** (翻新): 经过翻新处理的产品

**注意**: 当前版本不支持自定义成色，这是系统核心配置。

### 3. 税率设置

显示爱尔兰税法规定的三种增值税率：
- **VAT 23%**: 标准税率 - 适用于大部分商品
- **VAT 13.5%**: 减免税率 - 适用于维修服务等
- **VAT 0%**: 免税 - 适用于二手商品差价税制

**注意**: 税率设置涉及财务合规，当前版本不支持自定义修改。

### 4. 系统信息

显示系统运行状态和数据统计：
- 系统名称和版本
- 数据库连接状态
- 服务器运行状态
- 产品总数
- 有库存产品数
- 用户总数
- 供应商总数
- 采购发票数

---

## 🎯 访问方式

### 方法1: 从管理后台进入
1. 登录管理员账号
2. 进入管理后台 (admin.html)
3. 点击顶部标签栏的 "⚙️ 系统设置"

### 方法2: 直接访问
访问 URL: `http://localhost:3000/admin-system-settings.html`

---

## 🔧 技术实现

### 前端文件
- `public/admin-system-settings.html` - 系统设置管理页面

### 后端API
- `GET /api/admin/categories` - 获取所有分类
- `POST /api/admin/categories` - 创建新分类
- `PUT /api/admin/categories/:id` - 更新分类
- `DELETE /api/admin/categories/:id` - 删除分类
- `GET /api/admin/stats` - 获取系统统计

### 数据模型
- `models/ProductCategory.js` - 产品分类模型

### 控制器
- `controllers/admin/categoryController.js` - 分类管理控制器

---

## 📝 使用示例

### 添加新分类

1. 点击"添加分类"按钮
2. 填写分类信息：
   - 分类名称: "智能手表配件"
   - 分类类型: "手机配件"
   - 描述: "适用于各种智能手表的配件"
   - 默认税率: "VAT 23%"
   - 默认成色: "Brand New"
   - 排序权重: 10
3. 点击"保存"

### 编辑分类

1. 在分类列表中找到要编辑的分类
2. 点击"编辑"按钮
3. 修改需要更改的字段
4. 点击"保存"

### 删除分类

1. 在分类列表中找到要删除的分类
2. 点击"删除"按钮
3. 确认删除操作

**如果分类下有产品**:
- 系统会提示: "无法删除分类，还有 X 个产品使用此分类"
- 需要先将这些产品移动到其他分类
- 然后才能删除该分类

---

## ⚠️ 注意事项

### 1. 删除分类前的准备
- 检查该分类下是否有产品
- 如果有产品，需要先编辑这些产品，将它们移动到其他分类
- 确认无产品使用后，才能删除分类

### 2. 分类类型的选择
- 分类类型是预设的，不能自定义
- 选择最接近的类型
- 如果没有合适的类型，可以使用"手机配件"或"电脑配件"等通用类型

### 3. 税率设置
- 税率设置会影响产品的税务计算
- 请根据爱尔兰税法选择正确的税率
- 如有疑问，请咨询税务顾问

### 4. 成色设置
- 成色设置会影响产品的定价策略
- Brand New: 通常价格最高
- Pre-Owned: 二手产品，价格较低
- Refurbished: 翻新产品，价格介于两者之间

---

## 🔐 权限要求

- **访问权限**: 仅限管理员（admin角色）
- **操作权限**: 所有系统设置操作都需要管理员权限

---

## 📊 数据验证

### 创建/更新分类时的验证
- 分类名称: 必填，不能为空
- 分类类型: 必填，必须是预设的9种类型之一
- 默认税率: 必须是 VAT 23% / VAT 13.5% / VAT 0% 之一
- 默认成色: 必须是 Brand New / Pre-Owned / Refurbished 之一
- 排序权重: 必须是数字

### 删除分类时的验证
- 检查是否有产品使用该分类
- 如果有产品，阻止删除并提示产品数量

---

## 🎨 界面特点

### 1. 清晰的标签页布局
- 产品分类
- 设备成色
- 税率设置
- 系统信息

### 2. 友好的操作提示
- 每个标签页都有说明文字
- 操作按钮有明确的图标和文字
- 删除操作有二次确认

### 3. 响应式设计
- 适配不同屏幕尺寸
- 移动端友好

### 4. 模态框编辑
- 添加/编辑分类使用模态框
- 避免页面跳转
- 操作流畅

---

## 🚀 未来扩展

### 可能的功能增强
1. **批量操作**: 批量启用/禁用分类
2. **分类图标**: 为每个分类添加图标
3. **分类层级**: 支持多级分类（父分类-子分类）
4. **自定义字段**: 允许为分类添加自定义字段
5. **分类统计**: 显示每个分类下的产品数量和库存价值
6. **导入导出**: 支持分类数据的导入导出

### 可能的系统设置扩展
1. **公司信息**: 管理公司名称、地址、联系方式等
2. **发票设置**: 管理发票模板、编号规则等
3. **通知设置**: 管理系统通知和邮件提醒
4. **备份设置**: 管理数据备份策略
5. **日志查看**: 查看系统操作日志

---

## 📖 相关文档

- [产品分类模型](../models/ProductCategory.js)
- [分类控制器](../controllers/admin/categoryController.js)
- [管理员路由](../routes/admin.js)

---

## ✅ 测试步骤

### 1. 访问测试
```
1. 使用管理员账号登录 (admin/admin123)
2. 访问 http://localhost:3000/admin.html
3. 点击"⚙️ 系统设置"标签
4. 验证页面正常加载
```

### 2. 分类管理测试
```
1. 查看分类列表
2. 点击"添加分类"
3. 填写分类信息并保存
4. 验证分类添加成功
5. 编辑刚添加的分类
6. 验证分类更新成功
7. 尝试删除分类（如果有产品使用，应该被阻止）
```

### 3. 系统信息测试
```
1. 切换到"系统信息"标签
2. 验证系统统计数据正确显示
3. 检查数据库连接状态
```

---

## 🐛 已知问题

无

---

## 📝 更新日志

### v1.0.0 (2026-02-02)
- ✅ 创建系统设置管理页面
- ✅ 实现产品分类管理功能
- ✅ 添加设备成色说明
- ✅ 添加税率设置说明
- ✅ 添加系统信息展示
- ✅ 在admin.html中添加入口链接

---

**状态**: ✅ 已完成
**版本**: v1.0.0
**创建时间**: 2026-02-02
**最后更新**: 2026-02-02
