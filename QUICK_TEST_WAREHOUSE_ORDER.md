# 从仓库订货功能 - 快速测试指南

## 测试环境

- 服务器地址: http://localhost:3000
- 商户账号: MurrayRanelagh / 123456
- 仓管员账号: warehouse_manager / 123456

## 测试流程

### 第一步：商户下单

1. **登录商户账号**
   - 访问 http://localhost:3000/login.html
   - 用户名: `MurrayRanelagh`
   - 密码: `123456`

2. **浏览产品**
   - 点击"从仓库订货"标签页
   - 查看产品分类（大分类 → 小分类）
   - 浏览可订购的产品列表

3. **添加到购物车**
   - 点击产品卡片上的"加入购物车"按钮
   - 调整数量
   - 查看购物车右侧面板

4. **提交订单**
   - 点击"提交订单"按钮
   - 选择配送方式：
     - 物流配送：填写配送地址
     - 到店自取：选择自取地点
   - 填写备注（可选）
   - 点击"确认提交"

5. **查看订单**
   - 在"我的订单"部分查看刚创建的订单
   - 订单状态应该是"待确认"
   - 记录订单号（格式：WO-YYYYMMDD-XXXX）

### 第二步：仓管员确认订单

1. **登录仓管员账号**
   - 访问 http://localhost:3000/login.html
   - 用户名: `warehouse_manager`
   - 密码: `123456`

2. **查看订单列表**
   - 访问 http://localhost:3000/prototype-working.html
   - 点击"🛒 订单管理"标签页
   - 应该能看到刚才商户创建的订单
   - 订单状态显示"待确认"

3. **查看订单详情**
   - 点击订单的"查看详情"按钮
   - 检查订单信息：
     - 订单号
     - 商户名称
     - 产品列表
     - 总金额
     - 配送方式

4. **确认订单**
   - 点击"✅ 确认订单"按钮
   - 确认对话框点击"确定"
   - 订单状态变为"已确认"

### 第三步：仓管员发货

1. **标记发货**
   - 在订单详情中点击"🚚 标记发货"按钮
   - 确认对话框点击"确定"
   - 系统会：
     - 扣减仓库库存
     - 创建商户库存（MerchantInventory）
     - 记录库存转移（InventoryTransfer）
   - 订单状态变为"已发货"

2. **验证库存转移**
   - 切换到"📦 库存管理"标签页
   - 检查仓库库存是否减少
   - 登录商户账号查看库存是否增加

### 第四步：完成订单

1. **仓管员完成订单**
   - 在订单详情中点击"✅ 完成订单"按钮
   - 确认对话框点击"确定"
   - 订单状态变为"已完成"

2. **商户查看订单**
   - 登录商户账号
   - 在"我的订单"中查看订单状态
   - 应该显示"已完成"

## 测试场景

### 场景1：正常订单流程
- 商户下单 → 仓管员确认 → 发货 → 完成
- ✅ 验证库存转移正确

### 场景2：取消订单
- 商户下单 → 仓管员取消订单（输入原因）
- ✅ 订单状态变为"已取消"

### 场景3：库存不足
- 商户下单数量超过仓库库存
- ✅ 系统应该提示库存不足

### 场景4：筛选订单
- 使用状态筛选器：待确认、已确认、已发货、已完成
- 使用商户筛选器：输入商户名称
- ✅ 筛选结果正确

### 场景5：物流配送 vs 自取
- 测试两种配送方式
- ✅ 订单详情正确显示配送信息

## 验证要点

### 1. 订单创建
- [ ] 订单号格式正确（WO-YYYYMMDD-XXXX）
- [ ] 订单信息完整（商户、产品、金额、配送方式）
- [ ] 商户只能看到自己的订单

### 2. 订单状态流转
- [ ] pending → confirmed → shipped → completed
- [ ] 每个状态只能执行对应的操作
- [ ] 状态变更时间记录正确

### 3. 库存转移
- [ ] 发货时仓库库存减少
- [ ] 商户库存增加
- [ ] InventoryTransfer 记录创建
- [ ] 数量一致

### 4. 权限控制
- [ ] 商户只能看到自己的订单
- [ ] 仓管员可以看到所有订单
- [ ] 商户不能访问仓管员页面

### 5. 界面显示
- [ ] 订单列表显示正确
- [ ] 订单详情完整
- [ ] 状态徽章颜色正确
- [ ] 操作按钮根据状态显示

## 常见问题

### Q1: 订单列表为空
**A**: 检查是否有商户下单，刷新页面

### Q2: 发货失败
**A**: 检查仓库库存是否充足

### Q3: 商户看不到库存
**A**: 确认发货操作已完成，库存转移成功

### Q4: 订单详情打不开
**A**: 检查浏览器控制台错误，确认 API 正常

## 测试数据

### 测试商户
- MurrayRanelagh
- MurrayDundrum

### 测试产品
- 需要先在仓库中有库存产品
- 产品必须有批发价（wholesalePrice）

## 下一步

完成测试后：
1. 记录测试结果
2. 报告发现的问题
3. 验证所有功能正常工作
4. 准备生产环境部署

## 测试完成标志

- [ ] 完整订单流程测试通过
- [ ] 库存转移验证通过
- [ ] 权限控制验证通过
- [ ] 所有测试场景通过
- [ ] 无严重 bug

---

**测试日期**: 2026-02-02
**测试人员**: 
**测试结果**: 待测试
