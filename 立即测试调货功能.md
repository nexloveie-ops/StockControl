# 立即测试调货功能 🚀

## 快速开始

### 1. 确认服务器运行
服务器应该已经在运行：http://localhost:3000

### 2. 测试内部调拨（当前配置）

#### 步骤：
1. **打开浏览器**
   ```
   http://localhost:3000/merchant.html
   ```

2. **登录 MurrayDundrum**
   - 用户名: `MurrayDundrum`
   - 密码: `password123`

3. **进入群组库存**
   - 点击顶部的"群组库存"标签
   - 等待加载完成

4. **选择分类**
   - 点击任意分类卡片（例如：手机）

5. **发起调货**
   - 找到产品列表
   - 点击"🔄 调货"按钮

6. **查看调货确认对话框**
   应该看到：
   - 📦 内部调拨
   - ✅ 同一公司内部调拨
   - 调出方: MurrayRanelagh (Murray Electronics Limited)
   - 调入方: MurrayDundrum (Murray Electronics Limited)
   - 价格显示为"成本价"
   - 不显示 VAT

7. **确认调货**
   - 点击"✅ 确认调货"按钮
   - 应该显示成功消息和调货单号

### 3. 测试公司间销售

#### 步骤 A: 修改公司信息

1. **登录管理员**
   ```
   http://localhost:3000/admin.html
   ```
   - 用户名: `admin`
   - 密码: `admin123`

2. **修改用户公司信息**
   - 点击左侧"用户管理"
   - 找到 MurrayDundrum，点击"编辑"
   - 修改公司信息：
     ```
     公司名称: Tech Store Limited
     公司注册号: IE1234567
     VAT号: IE1234567TH
     ```
   - 点击"保存"

#### 步骤 B: 测试调货

1. **重新登录 MurrayDundrum**
   ```
   http://localhost:3000/merchant.html
   ```

2. **进入群组库存 → 选择分类 → 点击调货**

3. **查看调货确认对话框**
   应该看到：
   - 💰 公司间销售
   - 💼 不同公司间销售
   - 卖方: MurrayRanelagh (Murray Electronics Limited)
   - 买方: MurrayDundrum (Tech Store Limited)
   - 价格显示为"批发价"
   - 显示 VAT (23%)

4. **确认购买**
   - 点击"💰 确认购买"按钮
   - 应该显示成功消息和订单号

## 验证要点

### 内部调拨 ✅
- [ ] 显示"📦 内部调拨"
- [ ] 显示"同一公司"
- [ ] 使用成本价
- [ ] 不显示 VAT
- [ ] 按钮文字是"确认调货"

### 公司间销售 ✅
- [ ] 显示"💰 公司间销售"
- [ ] 显示"不同公司"
- [ ] 使用批发价
- [ ] 显示 VAT (23%)
- [ ] 按钮文字是"确认购买"

## 查看数据库

### 查看调货记录
```javascript
// 在 MongoDB Compass 中
db.inventorytransfers.find({}).sort({ createdAt: -1 }).limit(5)
```

### 查看销售发票（公司间销售）
```javascript
db.intercompanysalesinvoices.find({}).sort({ createdAt: -1 }).limit(5)
```

## 运行测试脚本

```bash
cd StockControl-main
node test-company-transfer.js
```

输出会显示：
- 用户公司信息
- 交易类型判断
- 可用库存
- 价格计算示例

## 遇到问题？

### 问题 1: 看不到调货按钮
**解决**: 刷新页面（Ctrl+F5）清除缓存

### 问题 2: 点击调货没有反应
**解决**: 
1. 打开浏览器控制台（F12）
2. 查看是否有错误信息
3. 检查服务器是否运行

### 问题 3: 显示错误的交易类型
**解决**: 
1. 运行测试脚本查看当前配置
2. 确认用户的公司信息设置

## 下一步

测试完成后，可以：
1. 查看调货记录（待实现）
2. 审批调货申请（待实现）
3. 确认收货（待实现）
4. 查看销售发票（待实现）

---
**服务器**: http://localhost:3000
**测试时间**: 约 5-10 分钟
**难度**: 简单 ⭐
