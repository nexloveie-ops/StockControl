# 🧪 产品分类管理测试指南

## 测试时间
2026-02-02

## 测试目标
验证简化后的产品分类管理功能是否正常工作，包括：
- ✅ 分类类型自由输入
- ✅ 默认税率动态加载
- ✅ 默认成色动态加载
- ✅ 增删改查功能
- ✅ 删除保护机制

---

## 🚀 快速测试步骤

### 前置条件
1. 服务器正在运行（进程 8）
2. 访问地址：http://localhost:3000
3. 管理员账号：admin / admin123

---

## 📋 测试用例

### 测试 1: 查看现有分类
**目的**: 验证分类列表显示正常

**步骤**:
1. 登录管理员账号
2. 点击"⚙️ 系统设置"
3. 进入"产品分类"标签页

**预期结果**:
- ✅ 显示分类列表
- ✅ 表格包含：分类类型、描述、默认税率、默认成色、排序、状态、操作
- ✅ 只显示分类类型，不显示分类名称

**实际结果**: _____________

---

### 测试 2: 添加新分类（自由输入）
**目的**: 验证可以自由输入分类类型

**步骤**:
1. 点击"+ 添加分类"按钮
2. 填写信息：
   - **分类类型**: 智能手表配件
   - **描述**: 适用于各种智能手表的配件
   - **默认税率**: VAT 23%
   - **默认成色**: BRAND_NEW
   - **排序权重**: 10
3. 点击"保存"

**预期结果**:
- ✅ 提示"分类添加成功"
- ✅ 分类列表中显示新分类
- ✅ 分类类型为"智能手表配件"

**实际结果**: _____________

---

### 测试 3: 验证默认税率动态加载
**目的**: 验证税率从数据库动态加载

**步骤**:
1. 切换到"税率设置"标签页
2. 记录现有税率数量
3. 添加新税率：
   - **税率代码**: VAT 9%
   - **显示名称**: VAT 9%
   - **税率**: 9
   - **描述**: 特殊商品税率
4. 返回"产品分类"标签页
5. 点击"+ 添加分类"
6. 查看"默认税率"下拉框

**预期结果**:
- ✅ 下拉框中显示新增的"VAT 9%"
- ✅ 包含所有数据库中的税率

**实际结果**: _____________

---

### 测试 4: 验证默认成色动态加载
**目的**: 验证成色从数据库动态加载

**步骤**:
1. 切换到"设备成色"标签页
2. 记录现有成色数量
3. 添加新成色：
   - **成色代码**: LIKE_NEW
   - **显示名称**: 准新
   - **描述**: 几乎全新的设备
4. 返回"产品分类"标签页
5. 点击"+ 添加分类"
6. 查看"默认成色"下拉框

**预期结果**:
- ✅ 下拉框中显示新增的"准新"
- ✅ 包含所有数据库中的成色

**实际结果**: _____________

---

### 测试 5: 编辑分类
**目的**: 验证分类编辑功能

**步骤**:
1. 在分类列表中找到"智能手表配件"
2. 点击"编辑"按钮
3. 修改信息：
   - **分类类型**: 智能穿戴配件
   - **描述**: 适用于智能手表、手环等穿戴设备的配件
4. 点击"保存"

**预期结果**:
- ✅ 提示"分类更新成功"
- ✅ 分类列表中显示更新后的信息
- ✅ 分类类型变为"智能穿戴配件"

**实际结果**: _____________

---

### 测试 6: 删除保护（有产品使用）
**目的**: 验证删除保护机制

**步骤**:
1. 创建一个测试分类"测试分类A"
2. 进入"采购订单管理"
3. 创建一个产品，分类选择"测试分类A"
4. 返回系统设置
5. 尝试删除"测试分类A"

**预期结果**:
- ✅ 提示"无法删除分类，还有 X 个产品使用此分类"
- ✅ 分类未被删除

**实际结果**: _____________

---

### 测试 7: 删除分类（无产品使用）
**目的**: 验证可以删除未使用的分类

**步骤**:
1. 创建一个测试分类"测试分类B"
2. 不创建任何产品
3. 尝试删除"测试分类B"
4. 确认删除

**预期结果**:
- ✅ 提示"分类删除成功"
- ✅ 分类从列表中消失

**实际结果**: _____________

---

### 测试 8: 分类类型唯一性
**目的**: 验证分类类型不能重复

**步骤**:
1. 添加分类"手机配件"
2. 再次尝试添加分类"手机配件"
3. 点击"保存"

**预期结果**:
- ✅ 提示错误信息（分类类型已存在）
- ✅ 分类未被创建

**实际结果**: _____________

---

### 测试 9: 必填字段验证
**目的**: 验证必填字段验证

**步骤**:
1. 点击"+ 添加分类"
2. 不填写任何信息
3. 直接点击"保存"

**预期结果**:
- ✅ 浏览器提示"请填写此字段"
- ✅ 分类未被创建

**实际结果**: _____________

---

### 测试 10: 排序功能
**目的**: 验证排序权重功能

**步骤**:
1. 创建三个分类：
   - 分类A，排序权重: 30
   - 分类B，排序权重: 10
   - 分类C，排序权重: 20
2. 刷新页面
3. 查看分类列表顺序

**预期结果**:
- ✅ 分类按排序权重升序排列
- ✅ 顺序为：分类B (10) → 分类C (20) → 分类A (30)

**实际结果**: _____________

---

## 🔍 数据库验证

### 验证数据结构
使用 MongoDB Compass 或命令行连接数据库，查看 `productcategories` 集合：

```javascript
// 查询所有分类
db.productcategories.find({ isActive: true })

// 验证字段
{
  _id: ObjectId,
  type: "智能穿戴配件",        // 分类类型（唯一）
  description: "...",          // 描述
  defaultVatRate: "VAT 23%",   // 默认税率
  defaultCondition: "BRAND_NEW", // 默认成色
  sortOrder: 10,               // 排序权重
  isActive: true,              // 状态
  createdAt: ISODate,
  updatedAt: ISODate
}
```

**验证点**:
- ✅ 没有 `name` 字段
- ✅ `type` 字段是唯一标识
- ✅ `defaultVatRate` 和 `defaultCondition` 可以是任意值（不限于枚举）

---

## 🐛 已知问题

### 问题 1: 采购订单中的分类选择
**描述**: admin.html 中的采购订单管理部分仍然使用硬编码的分类选项

**位置**: 
- 手动录入产品表格（第 1260 行）
- 图片识别产品表格（第 1836 行）

**影响**: 
- 新添加的分类不会出现在采购订单的下拉列表中
- 用户无法选择新创建的分类

**解决方案**: 
需要更新 admin.html，使其从 API 动态加载分类列表

**优先级**: 🔴 高

---

## 📝 测试记录

### 测试环境
- **日期**: 2026-02-02
- **服务器**: http://localhost:3000
- **进程ID**: 8
- **数据库**: MongoDB Atlas
- **测试人员**: _____________

### 测试结果汇总

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 测试 1: 查看现有分类 | ⬜ 待测试 | |
| 测试 2: 添加新分类 | ⬜ 待测试 | |
| 测试 3: 税率动态加载 | ⬜ 待测试 | |
| 测试 4: 成色动态加载 | ⬜ 待测试 | |
| 测试 5: 编辑分类 | ⬜ 待测试 | |
| 测试 6: 删除保护 | ⬜ 待测试 | |
| 测试 7: 删除分类 | ⬜ 待测试 | |
| 测试 8: 唯一性验证 | ⬜ 待测试 | |
| 测试 9: 必填字段 | ⬜ 待测试 | |
| 测试 10: 排序功能 | ⬜ 待测试 | |

**总体状态**: ⬜ 待测试

---

## 🔧 下一步工作

### 必须完成
1. 🔴 **更新 admin.html 中的分类选择**
   - 从硬编码改为动态加载
   - 手动录入和图片识别都需要更新
   - 确保新分类可以在采购订单中使用

### 建议完成
2. 🟡 **添加分类使用统计**
   - 在分类列表中显示产品数量
   - 帮助用户了解分类使用情况

3. 🟡 **批量操作**
   - 批量启用/禁用分类
   - 批量修改排序权重

4. 🟢 **导入导出**
   - 导出分类列表为 CSV
   - 从 CSV 导入分类

---

## 📚 相关文档

- [产品分类管理简化说明](CATEGORY_MANAGEMENT_SIMPLIFIED.md)
- [系统设置功能说明](ADMIN_SYSTEM_SETTINGS_FEATURE.md)
- [快速测试指南](QUICK_TEST_SYSTEM_SETTINGS.md)

---

**文档版本**: v1.0
**最后更新**: 2026-02-02
**状态**: ✅ 已完成
