# 需求文档

## 简介

本文档规定了3C（计算机、通信、消费电子）产品批发零售管理系统的需求。该系统管理配件和设备的库存，支持具有不同定价层级的多种用户角色，处理税务分类，并管理完整的采购和销售工作流程。

## 术语表

- **系统**: 3C产品管理系统
- **零售客户**: 以零售价购买产品的终端消费者
- **批发商户**: 具有分级定价的企业客户
- **仓管员**: 负责库存管理、价格调整和销售发票生成的用户
- **管理员**: 拥有完整系统访问权限的用户，包括采购和报表功能
- **配件类产品**: 通过条形码标识、基于数量管理库存的产品
- **设备类产品**: 具有唯一序列号（SN或IMEI）的独立产品
- **全新设备**: 全新的设备，带有完整保修
- **二手设备**: 具有成色等级（A+、A、B、C）的二手设备
- **采购订单**: 发送给供应商的采购单（PO）
- **销售发票**: 为客户购买生成的单据
- **采购发票**: 从供应商收到的包含采购产品的单据
- **VAT_23**: 标准增值税，税率为23%
- **Margin_VAT_0**: 某些二手设备的差额增值税，税率为0%
- **Service_VAT_13_5**: 服务增值税，税率为13.5%（预留给未来的维修服务）
- **产品状态**: 产品的当前状态（可销售、坏损、报废、已售）
- **商户等级**: 批发商户的定价级别分类
- **条形码**: 配件产品的唯一标识符
- **SN**: 设备识别的序列号
- **IMEI**: 国际移动设备识别码
- **成色等级**: 二手设备的质量分类（A+、A、B、C）

## 需求

### 需求1：用户认证与授权

**用户故事：** 作为系统用户，我希望通过基于角色的访问登录，以便访问与我职责相适应的功能。

#### 验收标准

1. WHEN 用户提供有效凭证时，THE 系统 SHALL 验证用户身份并根据其角色授予访问权限
2. WHEN 零售客户登录时，THE 系统 SHALL 提供产品浏览和以零售价购买的访问权限
3. WHEN 批发商户登录时，THE 系统 SHALL 根据其商户等级显示产品价格
4. WHEN 仓管员登录时，THE 系统 SHALL 提供库存管理、价格调整和销售发票生成的访问权限
5. WHEN 管理员登录时，THE 系统 SHALL 提供所有仓管员功能以及采购和报表功能的访问权限
6. WHEN 用户提供无效凭证时，THE 系统 SHALL 拒绝登录尝试并显示错误消息

### 需求2：产品信息管理

**用户故事：** 作为仓管员，我希望管理全面的产品信息，以便系统中准确跟踪所有产品详情。

#### 验收标准

1. THE 系统 SHALL 为每个产品存储进货价、进货税、建议零售价、批发价和分级批发价
2. THE 系统 SHALL 记录每个产品的采购日期、当前产品状态、仓储位置、供应商信息和关联的采购发票
3. THE 系统 SHALL 跟踪每个产品的销售状态（已售/未售）
4. WHEN 产品信息更新时，THE 系统 SHALL 立即持久化更改
5. THE 系统 SHALL 根据产品的税务分类（VAT_23、Margin_VAT_0或Service_VAT_13_5）计算进货税

### 需求3：配件类产品管理

**用户故事：** 作为仓管员，我希望通过条形码和数量管理配件产品，以便高效跟踪非序列化物品的库存。

#### 验收标准

1. THE 系统 SHALL 使用条形码标识配件类产品
2. WHEN 添加配件类产品时，THE 系统 SHALL 将多个数量与单个条形码关联
3. THE 系统 SHALL 跟踪每个条形码的库存数量
4. WHEN 配件类产品售出时，THE 系统 SHALL 将数量减少售出的数量
5. WHEN 配件类产品数量达到零时，THE 系统 SHALL 将其标记为缺货

### 需求4：设备类产品管理

**用户故事：** 作为仓管员，我希望使用唯一标识符管理单个设备，以便在整个生命周期中单独跟踪每个设备。

#### 验收标准

1. THE 系统 SHALL 为每个设备类产品创建单独的记录
2. THE 系统 SHALL 要求每个设备类产品具有SN或IMEI
3. WHEN 添加全新设备时，THE 系统 SHALL 将其分类为全新设备，税务分类为VAT_23
4. WHEN 添加二手设备时，THE 系统 SHALL 要求成色等级（A+、A、B或C）
5. WHEN 添加二手设备时，THE 系统 SHALL 允许选择VAT_23或Margin_VAT_0税务分类
6. THE 系统 SHALL 确保每个SN或IMEI在系统内唯一

### 需求5：价格管理

**用户故事：** 作为仓管员，我希望调整产品价格，以便定价反映市场状况和业务策略。

#### 验收标准

1. WHEN 仓管员更新产品价格时，THE 系统 SHALL 验证新价格为非负数
2. WHEN 仓管员更新定价时，THE 系统 SHALL 允许修改零售价、批发价和分级批发价
3. THE 系统 SHALL 维护价格历史记录以供审计
4. WHEN 价格更新时，THE 系统 SHALL 立即将新价格应用于未来交易
5. THE 系统 SHALL 保留现有销售发票价格，不受后续价格变更影响

### 需求6：分级批发定价

**用户故事：** 作为批发商户，我希望看到适合我等级的价格，以便获得与我业务关系相符的正确批发价格。

#### 验收标准

1. THE 系统 SHALL 支持具有不同定价的多个商户等级
2. WHEN 批发商户查看产品时，THE 系统 SHALL 显示与其商户等级对应的价格
3. WHEN 批发商户购买产品时，THE 系统 SHALL 应用其等级特定的定价
4. THE 系统 SHALL 防止批发商户用户查看其他等级的定价
5. WHEN 管理员创建或修改商户等级时，THE 系统 SHALL 相应更新定价可见性

### 需求7：销售发票生成

**用户故事：** 作为仓管员，我希望为客户购买生成销售发票，以便完成电子邮件或电话订单的销售交易。

#### 验收标准

1. WHEN 仓管员创建销售发票时，THE 系统 SHALL 包含客户信息、产品详情、数量、价格和税务计算
2. WHEN 生成销售发票时，THE 系统 SHALL 计算包含适用税费的总金额
3. WHEN 仓管员对销售发票应用折扣时，THE 系统 SHALL 验证折扣在管理员设置的允许范围内
4. WHEN 销售发票最终确定时，THE 系统 SHALL 将产品销售状态更新为已售
5. WHEN 销售发票包含配件类产品时，THE 系统 SHALL 相应减少库存数量

### 需求8：折扣授权

**用户故事：** 作为管理员，我希望为仓管员设置折扣限制，以便在实现客户服务的同时控制定价灵活性。

#### 验收标准

1. WHEN 管理员设置折扣范围时，THE 系统 SHALL 存储最小和最大折扣百分比
2. WHEN 仓管员应用折扣时，THE 系统 SHALL 验证其在授权范围内
3. IF 仓管员尝试超出授权范围的折扣，THEN THE 系统 SHALL 拒绝折扣并显示错误消息
4. THE 系统 SHALL 允许不同仓管员成员有不同的折扣范围
5. WHEN 管理员修改折扣范围时，THE 系统 SHALL 立即将新限制应用于后续交易

### 需求9：采购订单创建

**用户故事：** 作为管理员，我希望为供应商创建采购订单，以便采购库存以满足业务需求。

#### 验收标准

1. WHEN 管理员创建采购订单时，THE 系统 SHALL 包含供应商信息、产品规格、数量和预期价格
2. THE 系统 SHALL 生成唯一的采购订单标识符
3. WHEN 创建采购订单时，THE 系统 SHALL 将其状态设置为"草稿"
4. THE 系统 SHALL 允许管理员修改草稿采购订单详情
5. WHEN 管理员向供应商发送采购订单时，THE 系统 SHALL 将状态更新为"已发送"

### 需求10：采购订单修改

**用户故事：** 作为管理员，我希望根据供应商反馈修改采购订单，以便调整订单以匹配供应商的可用性。

#### 验收标准

1. WHEN 采购订单状态为"已发送"或"草稿"时，THE 系统 SHALL 允许管理员修改产品数量和规格
2. WHEN 管理员修改采购订单时，THE 系统 SHALL 维护修订历史
3. WHEN 管理员最终确定采购订单时，THE 系统 SHALL 将状态更新为"已下单"并防止进一步修改
4. THE 系统 SHALL 允许管理员在达到"已发货"状态之前取消采购订单
5. WHEN 采购订单被取消时，THE 系统 SHALL 将其状态更新为"已取消"

### 需求11：采购订单状态管理

**用户故事：** 作为管理员或仓管员，我希望更新采购订单状态，以便跟踪从订单到收货的采购生命周期。

#### 验收标准

1. WHEN 用户将采购订单更新为"已下单"时，THE 系统 SHALL 记录订单日期
2. WHEN 用户将采购订单更新为"已发货"时，THE 系统 SHALL 要求并存储跟踪号
3. WHEN 用户将采购订单更新为"已收货"时，THE 系统 SHALL 记录收货日期
4. WHEN 用户将采购订单更新为"已确认"时，THE 系统 SHALL 自动将所有产品添加到库存
5. THE 系统 SHALL 强制执行状态进展：草稿 → 已发送 → 已下单 → 已发货 → 已收货 → 已确认

### 需求12：自动库存更新

**用户故事：** 作为管理员，我希望在确认收到采购订单时自动更新库存，以便新库存立即可供销售。

#### 验收标准

1. WHEN 采购订单状态更改为"已确认"时，THE 系统 SHALL 为订单中的所有产品创建库存记录
2. WHEN 为配件类产品创建库存记录时，THE 系统 SHALL 将数量添加到现有条形码库存或创建新记录
3. WHEN 为设备类产品创建库存记录时，THE 系统 SHALL 创建具有唯一SN或IMEI的单独记录
4. THE 系统 SHALL 将所有新添加库存的产品状态设置为"可销售"
5. THE 系统 SHALL 将每个库存项目链接到其来源采购发票

### 需求13：采购发票管理

**用户故事：** 作为管理员，我希望管理来自供应商的采购发票，以便跟踪成本并将产品链接到其采购文档。

#### 验收标准

1. WHEN 管理员创建采购发票时，THE 系统 SHALL 包含供应商信息、跟踪号、产品列表、总金额、税务分类、付款方式、订单日期和交付日期
2. THE 系统 SHALL 将每个采购发票与其对应的采购订单关联
3. THE 系统 SHALL 计算包含所有适用税费的总金额
4. THE 系统 SHALL 允许管理员查看与特定采购发票关联的所有产品
5. WHEN 创建采购发票时，THE 系统 SHALL 验证所有必填字段已填充

### 需求14：库存状态管理

**用户故事：** 作为仓管员，我希望更新产品状态，以便跟踪损坏、报废或其他不可销售的产品。

#### 验收标准

1. WHEN 仓管员更新产品状态时，THE 系统 SHALL 允许从以下选项中选择：可销售、坏损、报废、已售
2. WHEN 产品状态更改为"坏损"或"报废"时，THE 系统 SHALL 将产品从可用库存计数中排除
3. WHEN 产品状态更改为"已售"时，THE 系统 SHALL 防止进一步的状态更改
4. THE 系统 SHALL 维护状态更改历史，包含时间戳和用户信息
5. WHEN 产品状态从"坏损"更改回"可销售"时，THE 系统 SHALL 将产品包含在可用库存计数中

### 需求15：仓储位置跟踪

**用户故事：** 作为仓管员，我希望跟踪产品仓储位置，以便快速定位物品进行配货。

#### 验收标准

1. THE 系统 SHALL 为每个产品存储仓储位置信息
2. WHEN 仓管员更新产品位置时，THE 系统 SHALL 验证该位置在系统中存在
3. THE 系统 SHALL 允许仓管员按仓储位置搜索产品
4. THE 系统 SHALL 在销售发票上显示仓储位置以供拣货
5. WHEN 产品售出时，THE 系统 SHALL 可选地清除其仓储位置

### 需求16：报表和分析

**用户故事：** 作为管理员，我希望查看业务报表，以便就库存、定价和采购做出明智决策。

#### 验收标准

1. THE 系统 SHALL 生成按产品类别显示当前库存水平的库存报表
2. THE 系统 SHALL 生成按时间段、产品类别和客户类型显示收入的销售报表
3. THE 系统 SHALL 生成显示采购成本、供应商绩效和订单状态的采购报表
4. THE 系统 SHALL 生成比较采购成本与销售价格的利润率报表
5. WHEN 管理员请求报表时，THE 系统 SHALL 允许按日期范围、产品类别、供应商和客户类型进行筛选

### 需求17：税务计算

**用户故事：** 作为仓管员，我希望系统自动计算税费，以便发票准确且符合税务法规。

#### 验收标准

1. WHEN 产品具有VAT_23分类时，THE 系统 SHALL 按基础价格的23%计算税费
2. WHEN 产品具有Margin_VAT_0分类时，THE 系统 SHALL 按0%计算税费
3. WHERE 实施Service_VAT_13_5时，THE 系统 SHALL 按服务价格的13.5%计算税费
4. WHEN 生成销售发票时，THE 系统 SHALL 汇总所有适用税费并与基础价格分开显示
5. WHEN 生成采购发票时，THE 系统 SHALL 根据产品税务分类计算并显示进货税

### 需求18：产品搜索和筛选

**用户故事：** 作为任何系统用户，我希望搜索和筛选产品，以便快速找到我需要的物品。

#### 验收标准

1. THE 系统 SHALL 允许用户按名称、条形码、SN或IMEI搜索产品
2. THE 系统 SHALL 允许用户按类别（配件类产品、全新设备、二手设备）筛选产品
3. THE 系统 SHALL 允许用户按产品状态筛选产品
4. THE 系统 SHALL 允许用户按成色等级筛选二手设备
5. WHEN 应用搜索或筛选时，THE 系统 SHALL 在2秒内返回包含多达100,000个产品的数据库结果

### 需求19：供应商管理

**用户故事：** 作为管理员，我希望管理供应商信息，以便为采购活动维护准确的记录。

#### 验收标准

1. THE 系统 SHALL 存储供应商名称、联系信息、付款条款和税务识别
2. WHEN 管理员创建供应商记录时，THE 系统 SHALL 验证必填字段已填充
3. THE 系统 SHALL 允许管理员查看与供应商关联的所有采购订单和采购发票记录
4. THE 系统 SHALL 允许管理员将供应商标记为活跃或不活跃
5. WHEN 供应商被标记为不活跃时，THE 系统 SHALL 防止为该供应商创建新的采购订单记录

### 需求20：数据完整性和验证

**用户故事：** 作为系统管理员，我希望系统维护数据完整性，以便业务运营可靠且准确。

#### 验收标准

1. WHEN 任何用户创建或更新记录时，THE 系统 SHALL 验证所有必填字段已填充
2. WHEN 任何用户输入数值时，THE 系统 SHALL 验证它们在可接受的范围内
3. THE 系统 SHALL 防止删除被其他记录引用的记录
4. WHEN 库存数量将变为负数时，THE 系统 SHALL 拒绝交易并显示错误消息
5. THE 系统 SHALL 维护产品、发票和采购订单之间的引用完整性
