# 🧪 群组管理功能快速测试指南

## 📋 测试前准备

### 1. 确认服务器运行
```bash
# 服务器应该在运行
# 访问: http://localhost:3000
```

### 2. 确认功能已添加
- ✅ 后端API已添加（app.js）
- ✅ 前端JavaScript已创建（admin-user-management.js）
- ✅ 群组模态框HTML已添加（admin.html）
- ✅ 群组管理按钮已添加

---

## 🧪 测试场景

### 场景1: 打开群组管理

#### 步骤
1. 访问 http://localhost:3000/admin.html
2. 点击"👥 用户管理"标签
3. 点击"👥 群组管理"按钮（绿色按钮）

#### 预期结果
- ✅ 显示群组管理模态框
- ✅ 显示群组列表（如果有群组）
- ✅ 显示"➕ 添加群组"和"关闭"按钮

---

### 场景2: 创建新群组

#### 步骤
1. 在群组管理模态框中，点击"➕ 添加群组"
2. 填写群组信息：
   - **群组名称**: 连锁店A
   - **群组代码**: CHAIN-A
   - **描述**: 连锁店A的所有门店
3. 业务设置保持默认（全部勾选）：
   - ✅ 允许店面间库存共享
   - ✅ 允许店面间调货
4. 确保"群组激活"已勾选
5. 点击"保存"

#### 预期结果
- ✅ 显示"保存成功"或"群组创建成功"消息
- ✅ 群组表单模态框自动关闭
- ✅ 群组列表自动刷新
- ✅ 新群组出现在列表中
- ✅ 群组代码自动转为大写（CHAIN-A）

---

### 场景3: 创建多个群组

#### 步骤
1. 创建第二个群组：
   - **群组名称**: 连锁店B
   - **群组代码**: CHAIN-B
   - **描述**: 连锁店B的所有门店
2. 创建第三个群组：
   - **群组名称**: 独立店铺联盟
   - **群组代码**: INDIE
   - **描述**: 独立店铺的合作联盟

#### 预期结果
- ✅ 所有群组创建成功
- ✅ 群组列表显示3个群组
- ✅ 每个群组显示用户数量（初始为0）

---

### 场景4: 编辑群组

#### 步骤
1. 在群组列表中找到"连锁店A"
2. 点击"编辑"按钮
3. 修改群组信息：
   - 修改描述为"连锁店A的所有门店 - 已更新"
   - 取消勾选"统一定价策略"
4. 点击"保存"

#### 预期结果
- ✅ 群组表单模态框显示当前群组信息
- ✅ 所有字段正确填充
- ✅ 保存成功
- ✅ 群组列表中的信息已更新

---

### 场景5: 查看群组详情

#### 步骤
1. 在群组列表中查看各列信息：
   - 群组名称
   - 群组代码（蓝色徽章）
   - 用户数量
   - 库存共享（✅/❌）
   - 店面调货（✅/❌）
   - 状态（活跃/停用）
   - 创建时间

#### 预期结果
- ✅ 所有信息正确显示
- ✅ 群组代码显示为蓝色徽章
- ✅ 用户数量显示为"0 人"（新创建的群组）
- ✅ 业务设置显示为✅或❌

---

### 场景6: 创建用户并关联群组

#### 步骤
1. 关闭群组管理模态框
2. 在用户列表中点击"➕ 添加用户"
3. 填写用户信息：
   - **用户名**: retail_chain_a_1
   - **邮箱**: retail_chain_a_1@example.com
   - **密码**: 123456
   - **角色**: 普通用户
4. 在"群组设置"中：
   - **所属群组**: 选择"连锁店A (CHAIN-A)"
   - **店面类型**: 连锁店
   - ✅ 可以查看群组内其他店面库存
   - ✅ 可以从群组内其他店面调货
5. 点击"保存"

#### 预期结果
- ✅ 用户创建成功
- ✅ 用户列表中显示该用户
- ✅ "所属群组"列显示"连锁店A"

---

### 场景7: 验证群组用户数量

#### 步骤
1. 创建2-3个用户，都关联到"连锁店A"
2. 打开群组管理
3. 查看"连锁店A"的用户数量

#### 预期结果
- ✅ 用户数量正确显示（例如：3 人）
- ✅ 其他群组的用户数量仍为0

---

### 场景8: 尝试删除有用户的群组

#### 步骤
1. 在群组管理中，找到"连锁店A"（有用户的群组）
2. 点击"停用"按钮
3. 确认操作

#### 预期结果
- ✅ 显示错误消息："该群组还有 X 个活跃用户，无法删除"
- ✅ 群组未被停用
- ✅ 群组状态仍为"活跃"

---

### 场景9: 删除空群组

#### 步骤
1. 找到一个没有用户的群组（例如："连锁店B"）
2. 点击"停用"按钮
3. 确认操作

#### 预期结果
- ✅ 显示确认对话框
- ✅ 确认后显示"群组已停用"消息
- ✅ 群组状态变为"停用"徽章（红色）
- ✅ 按钮文字变为"启用"

---

### 场景10: 用户筛选 - 按群组

#### 步骤
1. 关闭群组管理模态框
2. 在用户列表页面，找到"群组筛选"下拉框
3. 选择"连锁店A (CHAIN-A)"

#### 预期结果
- ✅ 用户列表只显示属于"连锁店A"的用户
- ✅ 其他群组的用户被过滤掉
- ✅ 独立用户（无群组）也被过滤掉

---

## 📊 群组列表显示内容

### 列标题
- 群组名称
- 群组代码
- 用户数量
- 库存共享
- 店面调货
- 状态
- 创建时间
- 操作

### 示例数据
```
群组名称: 连锁店A
群组代码: [CHAIN-A] (蓝色徽章)
用户数量: 3 人
库存共享: ✅
店面调货: ✅
状态: [活跃] (绿色徽章)
创建时间: 2026-02-03
操作: [编辑] [停用]
```

---

## ❌ 常见错误及解决方案

### 错误1: 点击"群组管理"没有反应
**原因**: JavaScript函数未加载或模态框HTML未添加
**解决**: 
1. 检查admin-user-management.js是否正确引用
2. 检查groupModal的HTML是否已添加
3. 打开浏览器控制台查看错误

### 错误2: 保存群组时提示"群组代码或名称已存在"
**原因**: 数据库中已有相同代码或名称的群组
**解决**: 使用不同的群组代码和名称

### 错误3: 群组列表显示"加载失败"
**原因**: API请求失败
**解决**: 
1. 检查服务器是否运行
2. 检查API路径（/api/admin/store-groups）
3. 查看浏览器Network标签

### 错误4: 无法删除群组，提示"还有X个活跃用户"
**原因**: 群组内有活跃用户
**解决**: 
1. 先将群组内的用户移到其他群组或设为独立用户
2. 或者先停用群组内的所有用户
3. 然后再删除群组

---

## 🔍 调试技巧

### 1. 查看群组API请求
```
GET /api/admin/store-groups
- 应该返回所有群组列表
- 包含用户数量统计

POST /api/admin/store-groups
- 创建新群组
- 返回创建的群组信息

PUT /api/admin/store-groups/:id
- 更新群组信息
- 返回更新后的群组信息

DELETE /api/admin/store-groups/:id
- 停用群组
- 检查是否有活跃用户
```

### 2. 查看用户-群组关联
```
GET /api/admin/users
- 用户对象包含 retailInfo.storeGroup
- 显示用户所属的群组信息
```

---

## 📊 测试检查清单

### 群组管理基本功能
- [ ] 可以打开群组管理模态框
- [ ] 可以查看群组列表
- [ ] 可以创建新群组
- [ ] 可以编辑群组信息
- [ ] 可以停用空群组
- [ ] 无法删除有用户的群组
- [ ] 可以启用已停用的群组

### 群组信息显示
- [ ] 群组名称正确显示
- [ ] 群组代码显示为蓝色徽章
- [ ] 用户数量正确统计
- [ ] 业务设置正确显示（✅/❌）
- [ ] 状态徽章颜色正确
- [ ] 创建时间正确显示

### 用户-群组关联
- [ ] 创建用户时可以选择群组
- [ ] 用户列表显示所属群组
- [ ] 群组筛选功能正常
- [ ] 群组用户数量实时更新

### 业务设置
- [ ] 库存共享设置可以保存
- [ ] 店面调货设置可以保存
- [ ] 统一定价设置可以保存
- [ ] 中央库存管理设置可以保存

---

## 📝 测试数据示例

### 群组1: 连锁店
```
群组名称: 星巴克连锁店
群组代码: STARBUCKS
描述: 星巴克咖啡连锁店的所有门店
业务设置:
  ✅ 允许店面间库存共享
  ✅ 允许店面间调货
  ✅ 统一定价策略
  ✅ 中央库存管理
```

### 群组2: 独立店铺联盟
```
群组名称: 独立咖啡店联盟
群组代码: INDIE-CAFE
描述: 独立咖啡店的合作联盟
业务设置:
  ✅ 允许店面间库存共享
  ✅ 允许店面间调货
  ❌ 统一定价策略
  ❌ 中央库存管理
```

### 群组3: 加盟店
```
群组名称: 7-11加盟店
群组代码: 7ELEVEN
描述: 7-11便利店加盟店
业务设置:
  ✅ 允许店面间库存共享
  ❌ 允许店面间调货
  ✅ 统一定价策略
  ✅ 中央库存管理
```

---

## 🎯 完整测试流程

### 1. 创建群组结构
1. 创建3个群组（连锁店A、连锁店B、独立联盟）
2. 验证群组列表显示正确

### 2. 创建用户并关联群组
1. 创建5个普通用户
2. 3个用户关联到"连锁店A"
3. 2个用户关联到"连锁店B"
4. 验证群组用户数量

### 3. 测试群组筛选
1. 使用群组筛选器
2. 验证筛选结果正确

### 4. 测试群组编辑
1. 编辑群组信息
2. 修改业务设置
3. 验证更新成功

### 5. 测试群组删除
1. 尝试删除有用户的群组（应该失败）
2. 删除空群组（应该成功）
3. 验证删除结果

---

**创建时间**: 2026-02-03
**版本**: 1.0
**状态**: ✅ 准备测试
