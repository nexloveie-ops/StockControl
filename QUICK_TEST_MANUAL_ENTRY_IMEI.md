# 快速测试：手动录入IMEI功能

## 测试目标
验证手动录入产品信息时，设备产品可以正确显示IMEI/SN输入框

## 测试前准备
1. 确保服务器正在运行
2. 使用管理员或仓库账户登录
3. 打开 `prototype-working.html`

## 测试步骤

### 测试1: 录入单个手机设备（中文分类）

1. **进入手动录入页面**
   - 点击顶部导航"入库管理"
   - 点击"手动录入"按钮

2. **填写供应商信息**
   - 供应商：选择任意供应商
   - 发票号码：TEST-001

3. **添加产品**
   - 点击"➕ 添加产品"按钮

4. **填写产品信息**
   - 产品名称：iPhone 15 Pro
   - 品牌：Apple
   - 型号/规格：15 Pro
   - 数量：1
   - 进货价：800
   - 批发价：900
   - 零售价：1000
   - **分类：选择包含"手机"或"设备"的分类**
   - 税务分类：VAT 23%
   - 成色：Brand New

5. **验证IMEI输入框**
   - ✅ "条码/IMEI/SN"列应该显示：`SN/IMEI 1 (必填)` 输入框
   - ✅ 输入框边框应该是红色（必填提示）
   - ✅ "颜色/类型"列应该显示：`颜色 1` 输入框

6. **填写IMEI和颜色**
   - IMEI: 123456789012345
   - 颜色: Natural Titanium

7. **确认入库**
   - 点击"✅ 确认入库"
   - 验证成功提示

8. **验证结果**
   - 检查库存中是否有该产品
   - 验证IMEI和颜色是否正确保存

---

### 测试2: 录入多个设备（英文分类）

1. **添加产品**
   - 点击"➕ 添加产品"

2. **填写产品信息**
   - 产品名称：Samsung Galaxy S24
   - 品牌：Samsung
   - 型号/规格：S24
   - 数量：**3**
   - 进货价：700
   - 批发价：800
   - 零售价：900
   - **分类：选择包含"Phone"或"Device"的分类**
   - 税务分类：VAT 23%
   - 成色：Brand New

3. **验证IMEI输入框**
   - ✅ 应该显示3个IMEI输入框：
     - SN/IMEI 1 (必填)
     - SN/IMEI 2 (必填)
     - SN/IMEI 3 (必填)
   - ✅ 应该显示3个颜色输入框：
     - 颜色 1
     - 颜色 2
     - 颜色 3

4. **填写所有IMEI和颜色**
   ```
   IMEI 1: 111111111111111  颜色: Black
   IMEI 2: 222222222222222  颜色: White
   IMEI 3: 333333333333333  颜色: Purple
   ```

5. **确认入库**
   - 点击"✅ 确认入库"
   - 验证3个设备分别入库

---

### 测试3: 录入配件产品（不显示IMEI）

1. **添加产品**
   - 点击"➕ 添加产品"

2. **填写产品信息**
   - 产品名称：iPhone Clear Case
   - 品牌：Generic
   - 型号/规格：iPhone 13
   - 颜色/类型：Clear
   - 数量：20
   - 进货价：5
   - 批发价：8
   - 零售价：12
   - **分类：选择"配件"或其他非设备分类**
   - 税务分类：VAT 23%
   - 成色：Brand New

3. **验证条码输入框**
   - ✅ "条码/IMEI/SN"列应该显示：单个`条码（可选）`输入框
   - ✅ 输入框边框应该是灰色（可选）
   - ✅ "颜色/类型"列应该显示：单个`颜色`输入框

4. **填写条码（可选）**
   - 条码：1234567890123（可以留空）

5. **确认入库**
   - 点击"✅ 确认入库"
   - 验证配件批量入库

---

### 测试4: 动态切换分类类型

1. **添加产品**
   - 点击"➕ 添加产品"

2. **初始选择配件分类**
   - 产品名称：Test Product
   - 分类：配件
   - 数量：1
   - ✅ 验证显示单个条码输入框

3. **切换为设备分类**
   - 修改分类：选择包含"手机"的分类
   - ✅ 验证自动切换为IMEI输入框

4. **修改数量**
   - 修改数量：5
   - ✅ 验证显示5个IMEI输入框

5. **再次切换回配件**
   - 修改分类：配件
   - ✅ 验证切换回单个条码输入框

---

### 测试5: 支持的分类关键字

测试以下分类名称是否能触发IMEI输入框：

#### 应该显示IMEI输入框的分类 ✅
- "全新设备"
- "二手设备"
- "手机"
- "New Phones"
- "iPhone"
- "Samsung"
- "平板电脑"
- "Tablets"
- "智能手表"
- "Watches"

#### 不应该显示IMEI输入框的分类 ❌
- "配件"
- "Accessories"
- "手机壳"
- "Cases"
- "屏幕保护膜"
- "Screen Protectors"

---

## 预期结果

### ✅ 成功标准
1. 选择设备类分类后，自动显示IMEI/SN输入框
2. IMEI输入框数量与产品数量一致
3. 每个设备可以单独填写IMEI和颜色
4. 配件产品显示单个条码输入框
5. 切换分类时，输入框类型正确切换
6. 数据正确保存到数据库

### ❌ 失败情况
1. 选择设备分类后仍显示条码输入框
2. IMEI输入框数量不正确
3. 无法填写IMEI
4. 数据保存失败

---

## 常见问题

### Q1: 选择了"手机"分类，但没有显示IMEI输入框？
**A**: 检查分类名称是否真的包含"手机"、"Phone"、"设备"等关键字。如果分类名称是其他文字，需要修改分类名称或添加关键字。

### Q2: 修改数量后，IMEI输入框没有更新？
**A**: 确保在数量输入框的`onchange`事件中调用了`updateManualProductRow(index)`函数。

### Q3: 填写了IMEI但保存失败？
**A**: 检查浏览器控制台是否有错误信息。确保所有必填的IMEI都已填写。

### Q4: 配件产品也显示了IMEI输入框？
**A**: 检查分类名称是否意外包含了设备关键字（如"Phone Case"包含"Phone"）。

---

## 调试技巧

### 1. 查看控制台日志
打开浏览器开发者工具（F12），查看控制台输出：
```
📝 添加手动产品行 0
   分类数据: 10 个
   成色数据: 6 个
```

### 2. 检查产品数据
在控制台输入：
```javascript
console.log(window.manualProducts);
```
查看当前产品数据结构

### 3. 检查分类检测
在控制台输入：
```javascript
const product = window.manualProducts[0];
const categoryLower = (product?.productType || '').toLowerCase();
console.log('分类:', product?.productType);
console.log('小写:', categoryLower);
console.log('是否设备:', categoryLower.includes('device') || categoryLower.includes('手机'));
```

---

## 相关文档
- `FIX_MANUAL_ENTRY_IMEI_DETECTION.md` - 详细修复说明
- `ADMIN_MANUAL_RECEIVING_VARIANT_SUPPORT.md` - 手动录入变体支持
- `WAREHOUSE_SHIPMENT_IMEI_SELECTION.md` - 仓库发货IMEI选择

---

**测试日期**: 2026-02-10
**功能状态**: ✅ 已修复并可测试
