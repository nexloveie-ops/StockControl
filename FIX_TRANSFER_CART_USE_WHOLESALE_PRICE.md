# 调货购物车使用批发价 ✅

## 修改内容

调货购物车中用于计算和显示的价格从零售价改为批发价。

## 原因

调货的实际成本是批发价，而不是零售价：
- **内部调拨**：使用成本价
- **公司间销售**：使用批发价

购物车应该显示调货的实际成本，帮助用户了解调货费用。

## 修改位置

### transfer-cart.js

#### updateTransferCart() 函数

**之前（错误）**：
```javascript
const cartTotal = transferCart.reduce((sum, item) => {
  // 暂时使用零售价显示，实际价格会在提交时根据公司信息计算
  return sum + (item.retailPrice * item.quantity);
}, 0);

// 单个产品显示
€${(item.retailPrice * item.quantity).toFixed(2)}
```

**现在（正确）**：
```javascript
const cartTotal = transferCart.reduce((sum, item) => {
  // 使用批发价计算，这是调货的实际成本
  return sum + (item.wholesalePrice * item.quantity);
}, 0);

// 单个产品显示
€${(item.wholesalePrice * item.quantity).toFixed(2)}
```

## 价格说明

### 购物车显示
- **显示价格**：批发价
- **用途**：显示调货的预估成本
- **说明**：实际调货价格会根据公司信息在提交时确定

### 实际调货价格
- **内部调拨**：使用成本价（比批发价低）
- **公司间销售**：使用批发价

### 为什么购物车显示批发价？
- 批发价是调货的最高成本
- 如果是内部调拨，实际价格会更低（成本价）
- 如果是公司间销售，实际价格就是批发价
- 显示批发价可以让用户了解最坏情况下的成本

## 示例

### 产品信息
```
产品: iPhone 14
成本价: €500
批发价: €600
零售价: €700
```

### 购物车显示
```
┌─────────────────────────────────────┐
│ 🛒 调货购物车                        │
├─────────────────────────────────────┤
│ iPhone 14                           │
│ 商户: MurrayRanelagh                │
│ SN: 123456789                       │
│                                     │
│ 1 台              €600.00 ✅        │
│                   (批发价)          │
├─────────────────────────────────────┤
│ 总计: €600.00                       │
└─────────────────────────────────────┘
```

### 实际调货价格

**场景 1: 内部调拨**
```
调货价格: €500（成本价）
比购物车显示低 €100
```

**场景 2: 公司间销售**
```
调货价格: €600（批发价）
与购物车显示一致
```

## 确认对话框

确认对话框中的价格已经正确使用了实际调货价格：

```javascript
const price = isInternalTransfer ? item.costPrice : item.wholesalePrice;
```

- **内部调拨**：显示成本价
- **公司间销售**：显示批发价

## 价格流程

```
1. 用户添加产品到购物车
   └─ 显示批发价（预估最高成本）

2. 用户提交调货申请
   └─ 系统判断交易类型

3. 确认对话框
   ├─ 内部调拨：显示成本价
   └─ 公司间销售：显示批发价

4. 调货完成
   ├─ 内部调拨：使用成本价
   └─ 公司间销售：使用批发价
```

## 优势

### 1. 清晰的成本预估
- ✅ 用户知道调货的最高成本
- ✅ 避免误解（不会以为是零售价）
- ✅ 帮助决策是否调货

### 2. 符合业务逻辑
- ✅ 批发价是调货的实际成本
- ✅ 零售价是销售给客户的价格
- ✅ 不应该混淆两者

### 3. 一致性
- ✅ 购物车显示批发价
- ✅ 确认对话框显示实际价格
- ✅ 最终调货使用实际价格

## 测试验证

### 测试步骤

1. **登录商户账号**
   ```
   http://localhost:3000/merchant.html
   用户名: MurrayDundrum
   密码: password123
   ```

2. **进入群组库存**
   - 点击"群组库存"标签
   - 选择产品分类

3. **查看产品价格**
   - 批发价：€600
   - 零售价：€700

4. **添加到购物车**
   - 点击"加入清单"
   - 查看购物车

5. **验证价格**
   - 购物车显示：€600 ✅（批发价）
   - 不应该显示：€700 ❌（零售价）

6. **提交调货申请**
   - 点击"提交调货申请"
   - 查看确认对话框

7. **验证确认对话框**
   - 内部调拨：显示成本价 €500
   - 公司间销售：显示批发价 €600

### 预期结果

**购物车**：
```
产品: iPhone 14
价格: €600.00（批发价）✅
```

**确认对话框（内部调拨）**：
```
产品: iPhone 14
单价: €500.00（成本价）✅
小计: €500.00
```

**确认对话框（公司间销售）**：
```
产品: iPhone 14
单价: €600.00（批发价）✅
小计: €600.00
VAT (23%): €138.00
总计: €738.00
```

## 注意事项

1. **购物车显示批发价**
   - 这是预估的最高成本
   - 实际价格可能更低（内部调拨）

2. **确认对话框显示实际价格**
   - 根据交易类型显示
   - 这是最终的调货价格

3. **不要混淆零售价**
   - 零售价是销售给客户的价格
   - 不是调货的成本

## 相关功能

- 调货购物车：显示批发价
- 调货确认：显示实际价格（成本价或批发价）
- 调货完成：使用实际价格创建库存

---
**完成日期**: 2026-02-05
**状态**: ✅ 已修复
**需要刷新页面**: 是
