# 立即测试调货管理功能 🚀

## 服务器状态
✅ 服务器正在运行: http://localhost:3000

## 快速测试步骤

### 第一步：发起调货申请

1. **打开浏览器访问**
   ```
   http://localhost:3000/merchant.html
   ```

2. **登录 MurrayDundrum**
   - 用户名: `MurrayDundrum`
   - 密码: `password123`

3. **发起调货**
   - 点击"群组库存"标签
   - 选择一个分类（例如：手机）
   - 点击产品的"查看详情"
   - 点击"🛒 加入清单"添加设备
   - 或者直接点击配件的"🛒 加入清单"
   - 点击右侧购物车的"提交调货申请"
   - 在确认对话框中点击"确认调货"

4. **记录调货单号**
   - 提交成功后会显示调货单号
   - 例如：TRF202602050001

### 第二步：审批调货申请

1. **退出登录**
   - 点击右上角"退出登录"

2. **登录 MurrayRanelagh**
   - 用户名: `MurrayRanelagh`
   - 密码: `password123`

3. **查看待审批**
   - 点击"调货管理"标签（新增的标签）
   - 默认显示"待审批"列表
   - 看到刚才发起的调货申请
   - 查看详细信息：
     * 调货单号
     * 交易类型（内部调拨）
     * 产品清单
     * 序列号/IMEI
     * 成色
     * 金额

4. **批准调货**
   - 点击"✅ 批准"按钮
   - 输入备注（可选）
   - 点击确定
   - 看到成功提示

### 第三步：确认收货

1. **退出登录**
   - 点击右上角"退出登录"

2. **登录 MurrayDundrum**
   - 用户名: `MurrayDundrum`
   - 密码: `password123`

3. **查看待收货**
   - 点击"调货管理"标签
   - 点击"待收货"子标签
   - 看到已批准的调货
   - 查看详细信息

4. **确认收货**
   - 点击"📦 确认收货"按钮
   - 在确认对话框点击"确定"
   - 看到成功提示
   - 库存已自动更新

### 第四步：验证结果

1. **查看已完成**
   - 在"调货管理"中点击"已完成"子标签
   - 看到刚才完成的调货记录

2. **查看库存**
   - 点击"我的库存"标签
   - 验证产品已添加到库存
   - 检查数量是否正确

3. **查看统计**
   - 查看首页的"我的库存"数量
   - 应该已增加

## 测试拒绝功能

### 步骤

1. **重复第一步**（MurrayDundrum 发起调货）

2. **登录 MurrayRanelagh**

3. **拒绝调货**
   - 进入"调货管理" → "待审批"
   - 点击"❌ 拒绝"按钮
   - 输入拒绝原因（必填）
   - 点击确定

4. **查看结果**
   - 登录 MurrayDundrum
   - 进入"调货管理" → "我发起的"
   - 看到"已拒绝"状态
   - 查看拒绝原因

## 功能亮点

### 1. 四个子标签
- ⏳ **待审批**: 其他商户向您发起的申请
- 📦 **待收货**: 已批准等待收货的调货
- 📤 **我发起的**: 您向其他商户发起的申请
- ✅ **已完成**: 所有已完成的调货记录

### 2. 徽章数量
- 每个子标签显示记录数量
- 实时更新

### 3. 详细信息
- 调货单号
- 交易类型（内部调拨 vs 公司间销售）
- 双方信息和公司信息
- 完整的产品清单
- 序列号/IMEI
- 成色
- 数量和价格
- 备注和拒绝原因

### 4. 操作按钮
- ✅ 批准（调出方）
- ❌ 拒绝（调出方）
- 📦 确认收货（调入方）

### 5. 自动更新
- 确认收货后自动更新库存
- 减少调出方库存
- 增加调入方库存
- 如果是公司间销售，生成销售发票

## 界面截图说明

### 调货管理主界面
```
┌─────────────────────────────────────────┐
│ 📋 调货管理                              │
│ 管理调货申请、审批和收货                  │
├─────────────────────────────────────────┤
│ [待审批 0] [待收货 0] [我发起的 0] [已完成 0] │
├─────────────────────────────────────────┤
│ ⏳ 待审批的调货申请                       │
│ 其他商户向您发起的调货申请，需要您审批      │
├─────────────────────────────────────────┤
│ 调货记录列表...                          │
└─────────────────────────────────────────┘
```

### 调货卡片
```
┌─────────────────────────────────────────┐
│ TRF202602050001  [待审批] [📦 内部调拨]  │
│ 2026-02-05 10:30:00          €1,234.56  │
├─────────────────────────────────────────┤
│ 调出方: MurrayRanelagh → 调入方: MurrayDundrum │
│ Murray Electronics Limited              │
├─────────────────────────────────────────┤
│ 产品清单 (2 件)                          │
│ ┌─────────────────────────────────────┐ │
│ │ 产品 | SN/IMEI | 成色 | 数量 | 价格  │ │
│ │ iPhone 14 | 123456 | AB | 1 | €500 │ │
│ │ 充电线 | - | - | 10 | €5           │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ [✅ 批准]  [❌ 拒绝]                     │
└─────────────────────────────────────────┘
```

## 常见问题

### Q1: 找不到"调货管理"标签？
**A**: 刷新页面，标签在"群组库存"和"仓库订货"之间

### Q2: 待审批列表是空的？
**A**: 需要先从另一个商户发起调货申请

### Q3: 点击批准没有反应？
**A**: 检查浏览器控制台是否有错误，确保服务器正在运行

### Q4: 确认收货后库存没有更新？
**A**: 刷新页面，或者切换到"我的库存"标签查看

### Q5: 如何查看历史记录？
**A**: 点击"已完成"子标签查看所有已完成的调货

## 技术细节

### API 端点
- `GET /api/merchant/inventory/transfer/list` - 获取调货列表
- `POST /api/merchant/inventory/transfer/approve` - 审批调货
- `POST /api/merchant/inventory/transfer/complete` - 确认收货

### 权限控制
- 只有调出方可以审批
- 只有调入方可以确认收货
- 双方都可以查看记录

### 状态流转
```
pending → approved → completed
pending → rejected
```

## 下一步

测试完成后，您可以：
1. 测试更多的调货场景
2. 测试拒绝功能
3. 查看已完成的历史记录
4. 验证库存更新是否正确
5. 测试公司间销售（需要设置不同的公司信息）

---
**准备好了吗？** 打开浏览器开始测试！🚀

**服务器地址**: http://localhost:3000
**测试账号**:
- MurrayDundrum / password123
- MurrayRanelagh / password123
