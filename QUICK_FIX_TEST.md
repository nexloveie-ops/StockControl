# 快速测试指南 - Bug修复验证

## 🚀 启动服务器

```bash
cd StockControl-main
node app-new.js
```

等待看到：
```
✅ MongoDB 连接成功
🚀 服务器运行在 http://localhost:3000
📊 管理界面: http://localhost:3000/
```

## 📋 测试清单

### ✅ 测试 1: 供货商发票查看（修复querySelector错误）

**步骤：**
1. 打开浏览器访问：`http://localhost:3000/prototype-working.html`
2. 点击顶部"👥 供货商/客户管理"标签
3. 在供货商列表中，点击任意供货商的"📋 查看发票"按钮

**预期结果：**
- ✅ 弹出模态框（白色背景，圆角边框）
- ✅ 标题显示：`📋 [供货商名称] - 采购发票记录`
- ✅ 显示发票表格或"暂无采购发票记录"
- ✅ 右上角有关闭按钮（×）
- ✅ 点击关闭按钮可以关闭模态框

**如果失败：**
- 打开浏览器控制台（F12）查看错误信息
- 检查是否有红色错误提示

---

### ✅ 测试 2: 客户管理加载（修复404错误）

**步骤：**
1. 在"供货商/客户管理"页面
2. 点击"🛒 客户管理"子标签按钮

**预期结果：**
- ✅ 按钮变为蓝色高亮
- ✅ 显示客户列表表格
- ✅ 或显示"暂无客户"提示（如果数据库中没有客户）
- ✅ 不显示"加载失败: HTTP 404"错误

**如果显示"暂无客户"：**
这是正常的，说明数据库中还没有客户数据。

**测试查看客户发票：**
1. 如果有客户数据，点击"📋 查看发票"按钮
2. 应该弹出模态框显示销售发票

---

### ✅ 测试 3: 产品追溯查询（修复500错误）

**步骤：**
1. 点击"🔍 产品追溯"子标签按钮
2. 在搜索框输入产品名称（例如：输入数据库中存在的产品名称）
3. 点击"🔍 查询追溯"按钮

**预期结果：**
- ✅ 显示"正在查询产品追溯信息..."加载提示
- ✅ 显示找到的产品卡片（蓝色边框）
  - 产品名称、SKU、条码、颜色
  - 当前库存数量
- ✅ 显示历史记录时间线
  - 采购记录（绿色圆点）
  - 销售记录（橙色圆点）
- ✅ 或显示"未找到匹配的产品"（如果搜索无结果）
- ✅ 不显示"查询失败: HTTP 500"错误

**如果没有产品数据：**
显示"未找到匹配的产品"是正常的。

---

## 🔍 API直接测试（可选）

如果前端测试有问题，可以直接测试API：

### 测试供货商API
```bash
curl http://localhost:3000/api/admin/suppliers
```
**预期：** 返回JSON格式的供货商列表

### 测试客户API
```bash
curl http://localhost:3000/api/admin/customers
```
**预期：** 返回JSON格式的客户列表（不是404）

### 测试产品追溯API
```bash
curl "http://localhost:3000/api/admin/products/tracking?search=test"
```
**预期：** 返回JSON格式的追溯结果（不是500）

---

## 🐛 如果还有问题

### 问题：模态框不显示
**检查：**
1. 打开浏览器控制台（F12）
2. 查看是否有JavaScript错误
3. 检查 `universalModal` 元素是否存在

### 问题：客户管理404
**检查：**
1. 查看浏览器Network标签
2. 确认请求URL是：`http://localhost:3000/api/admin/customers`
3. 查看服务器控制台是否有错误

### 问题：产品追溯500
**检查：**
1. 查看服务器控制台的错误信息
2. 确认MongoDB已连接
3. 检查是否有数据库查询错误

### 问题：数据库未连接
**解决：**
1. 检查 `.env` 文件中的 `MONGODB_URI`
2. 确认MongoDB Atlas网络访问权限
3. 重启服务器

---

## ✅ 成功标准

所有测试通过的标准：
- ✅ 供货商发票模态框正常显示
- ✅ 客户管理页面正常加载
- ✅ 产品追溯查询正常返回结果
- ✅ 没有控制台错误
- ✅ 没有404或500错误

---

## 📝 测试记录

测试日期：__________

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 供货商发票查看 | ☐ 通过 ☐ 失败 | |
| 客户管理加载 | ☐ 通过 ☐ 失败 | |
| 产品追溯查询 | ☐ 通过 ☐ 失败 | |

测试人员：__________

---

## 🎉 下一步

测试通过后，可以继续开发：
1. 添加供货商表单
2. 添加客户表单
3. 实现编辑功能
4. 增强用户体验
