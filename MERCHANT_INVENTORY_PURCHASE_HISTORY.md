# 商户库存进货历史功能

## 功能描述
在 `merchant.html` 的"我的库存"页面，点击任意产品行可以查看该产品的进货历史，按进货来源分组显示。

## 功能特点

### 1. 产品行可点击
- 点击大分类后的产品列表中的任意产品行
- 鼠标悬停时高亮显示（蓝色背景）
- 整行可点击，操作按钮区域除外

### 2. 进货历史模态框
显示该产品的完整进货历史，包括：

**统计信息**：
- 总库存数量
- 库存总价值
- 进货批次数量

**进货清单分组**：
1. **🏭 仓库订货**
   - 显示从仓库订购的批次
   - ✅ 点击可查看完整订单详情
   - 显示订单号、数量、价格信息、入库时间

2. **🔄 调货入库**
   - 显示从其他店面调货的批次
   - ✅ 点击可查看调货详情
   - 显示调货单号、数量、价格信息、入库时间

3. **✍️ 手动入库**
   - 显示手动录入的批次
   - 显示数量、价格、备注、入库时间

### 3. 仓库订单详情
点击仓库订货批次后，显示完整的订单信息：
- 订单号、状态、日期
- 配送方式、订单金额
- 订单中的所有产品列表
- 每个产品的详细信息（名称、型号、颜色、成色、数量、单价、小计）
- 订单总计（小计、税额、总计）
- 订单备注

### 4. 智能显示
- 有订单/调货单号的批次：显示箭头图标 →，可点击，鼠标悬停高亮
- 无订单/调货单号的批次：无箭头图标，不可点击，无悬停效果
- 所有批次都显示入库时间

## 修改文件
- `StockControl-main/public/merchant.html` (第4620-5000行)

## 使用方法

1. **进入我的库存**
   - 登录 merchant 账户
   - 点击"我的库存"标签

2. **选择分类**
   - 点击任意大分类（如 Pre-Owned Devices）

3. **查看进货历史**
   - 点击任意产品行
   - 弹出进货历史模态框

4. **查看详情**
   - 点击仓库订货批次 → 查看完整订单详情
   - 点击调货批次 → 查看调货详情
   - 手动入库批次直接显示所有信息

## 技术实现

### 前端函数
```javascript
// 显示产品进货历史
showProductPurchaseHistory(productName, brand, model, color, condition)

// 显示仓库订单详情（已实现）
showPurchaseOrderDetails(orderId)

// 显示调货详情
showTransferDetails(transferId)
```

### 后端API
- `GET /api/warehouse/orders/:id` - 获取仓库订单详情

### 数据来源
- 使用 `allInventoryDataIncludingZero` 全局变量
- 按 `source` 字段分组：
  - `warehouse`: 仓库订货
  - `transfer`: 调货入库
  - `manual`: 手动入库

### 关联字段
- `sourceOrderId`: 仓库订单ID
- `sourceTransferId`: 调货单ID

## 测试步骤

1. **测试产品行点击**
   - 点击产品行应该弹出进货历史
   - 鼠标悬停应该高亮
   - 操作按钮区域点击不应触发

2. **测试进货历史显示**
   - 验证统计信息正确
   - 验证按来源分组正确
   - 验证价格信息显示正确
   - 验证入库时间显示

3. **测试订单详情查看**
   - 点击仓库订货批次应该显示完整订单详情
   - 验证订单信息完整（订单号、状态、日期、金额）
   - 验证产品列表正确
   - 验证价格计算正确

4. **测试调货详情查看**
   - 点击调货批次应该显示调货详情

## 修复日期
2026-02-10

## 状态
✅ 已完成 - 包含完整的订单详情查看功能

