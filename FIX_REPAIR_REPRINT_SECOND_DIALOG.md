# 修复维修订单重新打印对话框被浏览器阻止问题

## 问题
点击维修订单的"🖨️ 打印"按钮后，Chrome浏览器显示警告：
```
A window.confirm() dialog generated by this page was suppressed because this page is not the active tab of the front window.
```

第二个对话框被浏览器阻止，因为打印窗口打开后，主窗口失去了焦点。

## 原因
Chrome浏览器的安全策略：当页面不是活动标签页时，会阻止 `confirm()` 对话框的显示。这是为了防止恶意网站在后台弹出对话框骚扰用户。

当第一张小票打印时，会打开新窗口，导致主窗口失去焦点，因此第二个 `confirm()` 被阻止。

## 解决方案
改变策略：在打印前一次性询问两个问题，然后根据用户的选择执行打印。

### 修改前（延迟询问）
```javascript
// 询问是否打印客户小票
const printCustomer = confirm('是否打印客人维修小票？');

if (printCustomer) {
  printCustomerRepairReceipt(...);
  await new Promise(resolve => setTimeout(resolve, 1500));
}

// 延迟后询问第二个问题（会被浏览器阻止）
const printWorkshop = confirm('是否打印店铺维修小票？');
```

### 修改后（连续询问）
```javascript
// 第一个询问：是否打印客户小票
const printCustomer = confirm('Do you want to print CUSTOMER receipt?\n是否打印客人维修小票？');

// 第二个询问：是否打印车间小票（立即询问，不延迟）
const printWorkshop = confirm('Do you want to print WORKSHOP ticket?\n是否打印店铺维修小票？');

// 根据选择执行打印
if (printCustomer) {
  printCustomerRepairReceipt(...);
  
  // 如果两张都要打印，延迟打印第二张
  if (printWorkshop) {
    setTimeout(() => {
      printWorkshopRepairReceipt(...);
    }, 1500);
  }
} else if (printWorkshop) {
  // 只打印车间小票
  printWorkshopRepairReceipt(...);
}
```

## 改进点
1. **连续询问**：在打印前一次性询问两个问题
2. **避免焦点丢失**：两个对话框都在主窗口有焦点时显示
3. **智能打印**：根据用户选择决定打印顺序和延迟
4. **更好的用户体验**：用户可以一次性决定要打印哪些小票

## 打印逻辑
- **两张都打印**：先打印客户小票，延迟1.5秒后打印车间小票
- **只打印客户小票**：立即打印客户小票
- **只打印车间小票**：立即打印车间小票
- **两张都不打印**：不执行任何打印操作

## 用户体验
用户会看到两个连续的对话框：
1. "Do you want to print CUSTOMER receipt? 是否打印客人维修小票？"
2. "Do you want to print WORKSHOP ticket? 是否打印店铺维修小票？"

然后系统根据用户的选择自动执行打印。

## 测试步骤
1. 使用 **Ctrl + Shift + R** 强制刷新浏览器
2. 进入"维修业务"页面
3. 点击任意订单的"🖨️ 打印"按钮
4. 立即看到第一个对话框："是否打印客人维修小票？"
   - 点击"确定"或"取消"
5. 立即看到第二个对话框："是否打印店铺维修小票？"
   - 点击"确定"或"取消"
6. 系统根据选择执行打印

## 测试场景
- **场景1**：两个都选"确定" → 先打印客户小票，1.5秒后打印车间小票
- **场景2**：第一个"确定"，第二个"取消" → 只打印客户小票
- **场景3**：第一个"取消"，第二个"确定" → 只打印车间小票
- **场景4**：两个都选"取消" → 不打印任何小票

## 文件修改
- `StockControl-main/public/merchant.html` - 修复 `reprintRepairReceipts()` 函数

## 状态
✅ 已修复

