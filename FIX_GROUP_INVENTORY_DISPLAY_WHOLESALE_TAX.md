# 群组库存显示批发价和税务分类 ✅

## 修改内容

在群组库存的产品信息中添加了批发价和税务分类的显示。

## 修改位置

### 1. 设备列表（有序列号的产品）

**之前的表头**：
```
商户 | 产品名称 | 品牌/型号 | 颜色 | 数量 | 零售价 | 操作
```

**现在的表头**：
```
商户 | 产品名称 | 品牌/型号 | 颜色 | 数量 | 批发价 | 零售价 | 税务分类 | 操作
```

### 2. 配件列表（无序列号的产品）

**之前的表头**：
```
商户 | 产品名称 | 品牌/型号 | 颜色 | 条码 | 库存 | 零售价 | 操作
```

**现在的表头**：
```
商户 | 产品名称 | 品牌/型号 | 颜色 | 条码 | 库存 | 批发价 | 零售价 | 税务分类 | 操作
```

## 显示内容

### 批发价
- 显示格式：`€600.00`
- 数据来源：`item.wholesalePrice`
- 用途：了解调货成本（公司间销售时使用批发价）

### 税务分类
- 显示格式：徽章样式
- 可能的值：
  - `VAT 23%` - 标准增值税
  - `VAT Margin` - 差额征税
  - `VAT 0%` - 零税率
  - `VAT Exempt` - 免税
- 数据来源：`item.taxClassification`
- 用途：了解产品的税务处理方式

## 代码修改

### merchant.html

#### 设备列表表头
```html
<th>商户</th>
<th>产品名称</th>
<th>品牌/型号</th>
<th>颜色</th>
<th>数量</th>
<th>批发价</th>        <!-- 新增 -->
<th>零售价</th>
<th>税务分类</th>      <!-- 新增 -->
<th>操作</th>
```

#### 设备列表数据行
```html
<td><strong>${group.merchantId}</strong></td>
<td>${group.productName}</td>
<td>${group.brand || ''} ${group.model || ''}</td>
<td>${group.color || '-'}</td>
<td><strong>${group.items.length}</strong> 台</td>
<td>€${group.wholesalePrice.toFixed(2)}</td>           <!-- 新增 -->
<td>€${group.retailPrice.toFixed(2)}</td>
<td>${getTaxBadge(group.taxClassification)}</td>       <!-- 新增 -->
<td>...</td>
```

#### 配件列表表头
```html
<th>商户</th>
<th>产品名称</th>
<th>品牌/型号</th>
<th>颜色</th>
<th>条码</th>
<th>库存</th>
<th>批发价</th>        <!-- 新增 -->
<th>零售价</th>
<th>税务分类</th>      <!-- 新增 -->
<th>操作</th>
```

#### 配件列表数据行
```html
<td><strong>${item.merchantId}</strong></td>
<td>${item.productName}</td>
<td>${item.brand || ''} ${item.model || ''}</td>
<td>${item.color || '-'}</td>
<td style="font-size: 11px; color: #666;">${item.barcode || '-'}</td>
<td>${item.quantity}</td>
<td>€${item.wholesalePrice.toFixed(2)}</td>            <!-- 新增 -->
<td>€${item.retailPrice.toFixed(2)}</td>
<td>${getTaxBadge(item.taxClassification)}</td>        <!-- 新增 -->
<td>...</td>
```

#### colspan 调整
设备详情展开行的 colspan 从 7 改为 9：
```html
<td colspan="9" style="background: #f8f9fa; padding: 15px;">
```

## 税务分类徽章

使用 `getTaxBadge()` 函数显示税务分类徽章：

```javascript
function getTaxBadge(tax) {
  const badges = {
    'VAT_23': '<span class="badge badge-primary">VAT 23%</span>',
    'VAT_MARGIN': '<span class="badge badge-warning">VAT Margin</span>',
    'VAT_0': '<span class="badge badge-info">VAT 0%</span>',
    'VAT_EXEMPT': '<span class="badge badge-success">VAT Exempt</span>'
  };
  return badges[tax] || '<span class="badge badge-secondary">未设置</span>';
}
```

## 显示效果

### 设备列表示例
```
┌──────────────┬────────────────┬──────────┬──────┬────┬────────┬────────┬──────────┬────────┐
│ 商户         │ 产品名称       │ 品牌/型号│ 颜色 │数量│ 批发价 │ 零售价 │ 税务分类 │ 操作   │
├──────────────┼────────────────┼──────────┼──────┼────┼────────┼────────┼──────────┼────────┤
│ MurrayRanelagh│ iPhone 14 128GB│ Apple    │ 黑色 │ 5台│ €600.00│ €700.00│ VAT 23%  │ 查看详情│
│              │ AB Grade       │ iPhone 14│      │    │        │        │          │        │
└──────────────┴────────────────┴──────────┴──────┴────┴────────┴────────┴──────────┴────────┘
```

### 配件列表示例
```
┌──────────────┬────────────┬──────────┬──────┬────────┬────┬────────┬────────┬──────────┬────────┐
│ 商户         │ 产品名称   │ 品牌/型号│ 颜色 │ 条码   │库存│ 批发价 │ 零售价 │ 税务分类 │ 操作   │
├──────────────┼────────────┼──────────┼──────┼────────┼────┼────────┼────────┼──────────┼────────┤
│ MurrayRanelagh│ USB-C 充电线│ Apple    │ 白色 │ 123456 │ 50 │ €15.00 │ €20.00 │ VAT 23%  │ 加入清单│
└──────────────┴────────────┴──────────┴──────┴────────┴────┴────────┴────────┴──────────┴────────┘
```

## 业务价值

### 1. 批发价显示
- ✅ 了解调货成本
- ✅ 公司间销售时使用批发价
- ✅ 帮助决策是否调货
- ✅ 计算利润空间

### 2. 税务分类显示
- ✅ 了解产品税务处理方式
- ✅ VAT 23%：标准增值税产品
- ✅ VAT Margin：二手产品差额征税
- ✅ 帮助税务合规

### 3. 完整信息
- ✅ 一目了然的产品信息
- ✅ 无需点击查看详情
- ✅ 提高决策效率

## 使用场景

### 场景 1: 查看调货成本

用户想从其他商户调货，需要了解成本：

1. **进入群组库存**
   - 选择产品分类

2. **查看产品信息**
   - 批发价：€600（公司间销售的调货价格）
   - 零售价：€700（销售给客户的价格）
   - 利润：€100

3. **决策**
   - 如果利润可接受，发起调货
   - 如果利润太低，不调货

### 场景 2: 了解税务分类

用户需要了解产品的税务处理：

1. **查看税务分类**
   - VAT 23%：标准增值税
   - VAT Margin：差额征税（二手产品）

2. **税务合规**
   - 根据税务分类正确处理税务
   - 避免税务错误

## 测试步骤

1. **登录商户账号**
   ```
   http://localhost:3000/merchant.html
   用户名: MurrayDundrum
   密码: password123
   ```

2. **进入群组库存**
   - 点击"群组库存"标签

3. **选择分类**
   - 选择"手机"分类

4. **验证设备列表**
   - 查看表头：应该有"批发价"和"税务分类"列
   - 查看数据：批发价显示为 €xxx.xx
   - 查看徽章：税务分类显示为徽章样式

5. **选择配件分类**
   - 选择"配件"分类

6. **验证配件列表**
   - 查看表头：应该有"批发价"和"税务分类"列
   - 查看数据：批发价和税务分类正确显示

## 注意事项

1. **数据完整性**
   - 确保产品有 wholesalePrice 字段
   - 确保产品有 taxClassification 字段
   - 如果缺失，显示默认值

2. **显示格式**
   - 批发价：保留两位小数
   - 税务分类：使用徽章样式
   - 对齐方式：价格右对齐

3. **响应式设计**
   - 表格可能较宽
   - 考虑横向滚动
   - 保持可读性

## 相关功能

- 调货购物车：使用批发价计算调货成本
- 调货管理：显示调货价格和税务信息
- 价格策略：根据税务分类计算税额

---
**完成日期**: 2026-02-05
**状态**: ✅ 已完成
**需要刷新页面**: 是
