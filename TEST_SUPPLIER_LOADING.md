# 供应商加载测试指南

## 📅 日期
2026-02-02

## 🎯 目的
测试供应商数据是否能正确加载到下拉框中。

## 🧪 测试页面

### 1. 专用测试页面
访问：http://localhost:3000/test-suppliers.html

**功能：**
- 自动测试 API
- 自动加载供应商到下拉框
- 显示详细的调试日志
- 可以重新加载测试

**预期结果：**
- ✅ API 返回 200 状态
- ✅ 获取到 6 个供应商
- ✅ 下拉框显示所有供应商
- ✅ 可以选择供应商

### 2. 原始页面测试
访问：http://localhost:3000/prototype-working.html

**步骤：**
1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 点击"入库管理"
4. 点击"手动录入"按钮
5. 查看控制台日志

**预期日志：**
```
🔄 切换入库模式: manual
✅ 切换到手动录入模式
🔄 准备加载供应商列表...
🔄 开始加载供应商...
🔄 loadSuppliers: 开始加载供应商数据
📡 发送请求到 /api/suppliers
📥 收到响应: 200 OK
📦 解析JSON结果: {success: true, data: Array(6)}
✅ 供应商数量: 6
📦 获取到供应商数据: (6) [{…}, {…}, {…}, {…}, {…}, {…}]
✅ 找到 select 元素: <select id="manualSupplier">
  添加供应商 1: Xtreme Tech Ltd 697fe03a2cb7f58b62375297
  添加供应商 2: Apple 官方供应商 6980f4d436793fec81023fe7
  添加供应商 3: Samsung 配件供应商 6980f4d436793fec81023fea
  添加供应商 4: 华为配件批发 6980f4d436793fec81023fed
  添加供应商 5: 小米爱尔兰总代理 6980f4d436793fec81023ff3
  添加供应商 6: 通用配件供应商 6980f4d436793fec81023ff9
✅ 成功加载了 6 个供应商
```

## 🔍 故障排查

### 问题1：控制台没有日志
**原因：** JavaScript 未执行或有错误

**解决：**
1. 检查浏览器控制台是否有错误
2. 刷新页面（Ctrl+F5 强制刷新）
3. 清除浏览器缓存

### 问题2：API 返回 404
**原因：** 服务器未启动或路由错误

**解决：**
1. 确认服务器正在运行
2. 访问 http://localhost:3000/api/suppliers
3. 检查服务器日志

### 问题3：下拉框仍然为空
**原因：** 可能的原因：
- JavaScript 执行顺序问题
- DOM 元素未找到
- 数据格式问题

**解决：**
1. 使用测试页面验证
2. 查看控制台日志
3. 检查 select 元素 ID

### 问题4：数据加载但不显示
**原因：** 可能是 CSS 或 DOM 问题

**解决：**
1. 检查 select 元素是否可见
2. 使用浏览器检查器查看 DOM
3. 验证 option 元素是否被添加

## 📊 测试结果记录

### 测试环境
- 服务器：http://localhost:3000
- 进程 ID：24
- 数据库：MongoDB Atlas
- 供应商数量：6

### 测试项目

| 测试项 | 预期结果 | 实际结果 | 状态 |
|--------|---------|---------|------|
| API 可访问 | 200 OK | | ⏳ |
| 返回数据格式 | {success: true, data: [...]} | | ⏳ |
| 供应商数量 | 6 | | ⏳ |
| 下拉框加载 | 显示 6 个选项 | | ⏳ |
| 可以选择 | 能选择供应商 | | ⏳ |

## 🛠️ 调试工具

### 1. 浏览器控制台
```javascript
// 手动测试 API
fetch('/api/suppliers')
  .then(r => r.json())
  .then(d => console.log(d));

// 检查 select 元素
document.getElementById('manualSupplier');

// 手动加载供应商
loadSuppliersForManual();
```

### 2. 网络面板
1. 打开开发者工具
2. 切换到 Network 标签
3. 刷新页面
4. 查找 /api/suppliers 请求
5. 检查响应数据

### 3. 元素检查器
1. 右键点击供应商下拉框
2. 选择"检查元素"
3. 查看 DOM 结构
4. 验证 option 元素

## 📝 更新日志

### 2026-02-02
- ✅ 创建测试供应商数据（6个）
- ✅ 添加详细的控制台日志
- ✅ 创建专用测试页面
- ✅ 更新文档

## 🎯 下一步

1. **访问测试页面**
   ```
   http://localhost:3000/test-suppliers.html
   ```

2. **查看控制台日志**
   - 打开开发者工具（F12）
   - 查看 Console 标签

3. **验证功能**
   - API 是否正常
   - 数据是否加载
   - 下拉框是否显示

4. **报告问题**
   - 截图控制台日志
   - 记录错误信息
   - 提供测试结果

---

**开始测试：** http://localhost:3000/test-suppliers.html  
**祝测试顺利！** 🚀
