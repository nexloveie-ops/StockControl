# 快速测试：群组库存调货购物车

## 日期
2026-02-11

## 测试目标
验证群组库存调货功能的两个改进：
1. 设备不在源店铺选择IMEI，而是在目标店铺出货时选择
2. 设备可以选择数量，不再固定为1

## 测试环境

### 测试账号
```
用户名：MurrayRanelagh
密码：123456

用户名：MurrayDundrum
密码：123456
```

### 访问地址
http://localhost:3000

## 测试步骤

### 测试1：设备支持数量选择

#### 步骤
1. 登录 MurrayRanelagh
2. 点击"群组库存"标签
3. 选择 MurrayDundrum 店铺
4. 点击"手机"分类
5. 选择一个手机产品（例如：Samsung Galaxy S22）
6. 如果有变体，选择型号和颜色

#### 预期结果
- ✅ 产品添加到右侧"调货清单"
- ✅ 初始数量显示为 1
- ✅ 有 "+" 和 "-" 按钮可以调整数量
- ✅ 不显示序列号或IMEI
- ✅ 显示产品名称、型号、颜色、成色
- ✅ 显示单价和小计

#### 操作验证
1. 点击 "+" 按钮
   - ✅ 数量增加到 2
   - ✅ 小计金额更新（单价 × 2）
   - ✅ 总计金额更新

2. 点击 "-" 按钮
   - ✅ 数量减少到 1
   - ✅ 小计金额更新
   - ✅ 总计金额更新

3. 继续点击 "+" 直到达到库存上限
   - ✅ 显示提示："库存不足，最多可调货 X 件"
   - ✅ 数量不再增加

### 测试2：配件支持数量选择

#### 步骤
1. 在群组库存中选择"配件"分类
2. 选择一个配件产品（例如：手机壳、充电器）
3. 点击"加入调货清单"

#### 预期结果
- ✅ 配件添加到调货清单
- ✅ 初始数量为 1
- ✅ 可以使用 "+" 和 "-" 调整数量
- ✅ 价格计算正确

### 测试3：相同产品自动合并

#### 步骤
1. 添加一个产品到购物车（例如：iPhone 13 - 128GB - Blue）
2. 再次添加相同的产品（相同型号、颜色、成色）

#### 预期结果
- ✅ 不创建新的购物车项
- ✅ 原有项的数量自动 +1
- ✅ 显示提示："✅ 已增加数量"

### 测试4：不同变体分别显示

#### 步骤
1. 添加 iPhone 13 - 128GB - Blue × 2
2. 添加 iPhone 13 - 256GB - Blue × 1
3. 添加 iPhone 13 - 128GB - Red × 1

#### 预期结果
- ✅ 购物车显示 3 个独立的项
- ✅ 每个项显示不同的型号或颜色
- ✅ 数量分别计算
- ✅ 总计 = 4 件产品

### 测试5：移除产品

#### 步骤
1. 购物车中有多个产品
2. 点击某个产品的"移除"按钮

#### 预期结果
- ✅ 该产品从购物车中删除
- ✅ 其他产品保留
- ✅ 总计金额更新
- ✅ 产品数量更新

### 测试6：清空购物车

#### 步骤
1. 购物车中有多个产品
2. 点击"清空清单"按钮
3. 确认对话框点击"确定"

#### 预期结果
- ✅ 显示确认对话框："确定要清空调货清单吗？"
- ✅ 所有产品被清空
- ✅ 显示："调货清单是空的"
- ✅ 总计显示 €0.00
- ✅ 数量显示 0

### 测试7：提交调货申请

#### 步骤
1. 添加多个产品到购物车：
   - Samsung Galaxy S22 × 2
   - iPhone 13 × 1
   - 手机壳 × 5
2. 点击"提交调货申请"按钮
3. 查看确认对话框
4. 点击"确定"

#### 预期结果
- ✅ 显示确认对话框，包含：
  - 目标店铺名称
  - 产品清单（名称、型号、颜色、数量）
  - 总金额
- ✅ 提交成功后显示：
  - "✅ 调货申请已提交！"
  - 调货单号
  - "等待 XXX 审批"
- ✅ 购物车自动清空
- ✅ 返回到店铺选择界面

### 测试8：验证不包含IMEI

#### 步骤
1. 添加一个有序列号的设备到购物车
2. 提交调货申请
3. 登录 MurrayDundrum
4. 进入"调货管理" → "待审批"
5. 查看调货申请详情

#### 预期结果
- ✅ 调货申请中不显示序列号/IMEI
- ✅ 只显示产品名称、型号、颜色、数量
- ✅ 审批通过后，在发货环节才选择具体的IMEI

### 测试9：切换店铺清空购物车

#### 步骤
1. 选择 MurrayDundrum 店铺
2. 添加产品到购物车
3. 点击"← 返回店铺选择"

#### 预期结果
- ✅ 显示确认对话框："返回店铺选择将清空当前调货清单，确定要继续吗？"
- ✅ 点击"确定"后购物车清空
- ✅ 返回到店铺选择界面
- ✅ 点击"取消"则保留购物车内容

### 测试10：库存数量限制

#### 步骤
1. 查看某个产品的可用库存（例如：3件）
2. 添加到购物车
3. 尝试将数量增加到超过库存数量

#### 预期结果
- ✅ 数量可以增加到库存上限（3件）
- ✅ 尝试增加到4件时显示："库存不足，最多可调货 3 件"
- ✅ 数量保持在3件

## 功能对比

### 修改前
| 功能 | 设备 | 配件 |
|------|------|------|
| 数量选择 | ❌ 固定为1 | ✅ 可选择 |
| IMEI选择 | ❌ 立即选择 | N/A |
| 购物车显示 | ❌ 显示序列号 | ✅ 正常 |

### 修改后
| 功能 | 设备 | 配件 |
|------|------|------|
| 数量选择 | ✅ 可选择 | ✅ 可选择 |
| IMEI选择 | ✅ 延后到收货 | N/A |
| 购物车显示 | ✅ 不显示序列号 | ✅ 正常 |

## 业务流程

### 新的调货流程

#### 1. 源店铺（MurrayRanelagh）
1. 选择目标店铺（MurrayDundrum）
2. 浏览群组库存
3. 选择产品：
   - iPhone 13 - 128GB - Blue × 3
   - Samsung Galaxy S22 × 2
4. 调整数量（使用 +/- 按钮）
5. 提交调货申请（不包含IMEI）

#### 2. 目标店铺（MurrayDundrum）
1. 收到调货申请通知
2. 查看申请详情：
   - iPhone 13 - 128GB - Blue × 3（无IMEI）
   - Samsung Galaxy S22 × 2（无IMEI）
3. 审批通过
4. 准备发货时，从库存中选择具体的IMEI：
   - iPhone 13: IMEI001, IMEI002, IMEI003
   - Samsung: IMEI004, IMEI005
5. 确认发货

#### 3. 源店铺收货
1. 收到货物
2. 确认收货
3. 产品进入库存（带有IMEI）

## 常见问题

### Q1: 为什么设备不在添加时选择IMEI？
**A:** 因为实际业务中，发货方需要根据实际情况选择具体的设备。提前绑定IMEI可能导致：
- 选择的设备已被其他订单占用
- 需要更换设备但申请已提交
- 增加了申请流程的复杂度

### Q2: 设备数量上限是多少？
**A:** 数量上限等于该产品在目标店铺的可用库存总数。系统会自动计算并限制。

### Q3: 如果添加相同产品会怎样？
**A:** 系统会自动识别相同产品（名称、型号、颜色、成色都相同），并增加数量而不是创建新项。

### Q4: 可以同时向多个店铺调货吗？
**A:** 不可以。每次只能选择一个目标店铺。如需向多个店铺调货，需要分别提交申请。

### Q5: 提交后可以修改吗？
**A:** 提交后不能直接修改。如需修改，需要取消原申请并重新提交。

## 故障排查

### 问题1：点击"+"按钮没反应
**检查：**
- 是否已达到库存上限
- 浏览器控制台是否有错误
- 刷新页面重试（Ctrl + Shift + R）

### 问题2：购物车不显示
**检查：**
- 是否已选择目标店铺
- 是否成功添加产品
- 检查浏览器控制台错误

### 问题3：提交失败
**检查：**
- 网络连接是否正常
- 服务器是否运行
- 查看错误提示信息
- 检查后端日志

### 问题4：数量显示不正确
**检查：**
- 刷新页面
- 清空购物车重新添加
- 检查库存数据是否正确

## 测试检查清单

- [ ] 设备可以选择数量（不固定为1）
- [ ] 配件可以选择数量
- [ ] 购物车不显示IMEI/序列号
- [ ] 相同产品自动合并
- [ ] 不同变体分别显示
- [ ] 可以增加/减少数量
- [ ] 可以移除单个产品
- [ ] 可以清空购物车
- [ ] 库存数量限制生效
- [ ] 提交申请成功
- [ ] 申请中不包含IMEI
- [ ] 切换店铺时提示清空
- [ ] 价格计算正确
- [ ] 总计金额正确

## 成功标准

所有测试项通过，且：
1. ✅ 设备和配件都支持数量选择
2. ✅ 调货申请不包含IMEI/序列号
3. ✅ 购物车功能完整可用
4. ✅ 用户体验流畅
5. ✅ 没有JavaScript错误

## 下一步

测试通过后：
1. 更新后端API支持不带序列号的调货
2. 实现目标店铺的IMEI选择功能
3. 更新调货管理界面
4. 完善文档

---

**开始测试！** 🚀

如有问题，请检查：
- 浏览器控制台（F12）
- 服务器日志
- 网络请求（Network标签）
