# 快速测试：商户销售业务（购物车模式）

## 测试目标
验证新的购物车式销售流程，包括分类浏览、购物车、混合支付等功能。

## 测试环境
- 服务器地址：http://localhost:3000
- 商户账号：merchant_001 / merchant123

## 前置条件
确保商户库存中有产品。如果没有，请先：
1. 进入"我的库存"标签
2. 点击"+ 手动入库"添加一些产品

## 测试步骤

### 步骤 1：查看产品分类

1. 登录商户账号：merchant_001 / merchant123
2. 默认进入"销售业务"标签页
3. **预期结果**：
   - 显示产品分类卡片（彩色渐变背景）
   - 每个分类显示产品种类数和总库存数
   - 例如："Type-C Cable 1M - 1 种产品 · 10 件库存"

### 步骤 2：浏览分类产品

1. 点击任意分类卡片
2. **预期结果**：
   - 显示该分类下的所有产品
   - 每个产品显示：名称、品牌、型号、颜色、库存、价格
   - 配件类产品显示"+ 加入购物车"按钮（绿色）
   - 设备类产品显示"选择设备"按钮（蓝色）

### 步骤 3：添加配件到购物车

1. 找到一个配件产品（如数据线）
2. 点击"+ 加入购物车"按钮
3. **预期结果**：
   - 弹出提示"✅ [产品名] 已添加到购物车"
   - 页面顶部出现购物车摘要（蓝色背景）
   - 显示商品数量和总金额
   - 显示"💳 结账"和"清空"按钮

### 步骤 4：添加多个产品

1. 继续点击其他产品的"加入购物车"按钮
2. 同一产品可以多次点击（数量+1）
3. **预期结果**：
   - 购物车数量和总额实时更新
   - 例如："🛒 购物车：3 件商品 总计：€15.00"

### 步骤 5：结账流程

1. 点击"💳 结账"按钮
2. **预期结果**：
   - 弹出结账模态框
   - 显示购物车明细（产品、数量、单价、小计）
   - 显示总计金额
   - 显示客户电话输入框（可选）
   - 显示三个支付方式按钮

### 步骤 6：测试现金支付

1. 在结账界面点击"💵 现金"按钮
2. **预期结果**：
   - 现金按钮高亮（蓝色边框和背景）
   - 不显示混合支付输入框
3. 点击"✅ 确认支付"
4. **预期结果**：
   - 显示"✅ 销售成功！"消息
   - 显示订单号和总金额
   - 购物车清空
   - 返回分类列表

### 步骤 7：测试刷卡支付

1. 添加产品到购物车
2. 点击"💳 结账"
3. 点击"💳 刷卡"按钮
4. 点击"✅ 确认支付"
5. **预期结果**：销售成功

### 步骤 8：测试混合支付

1. 添加产品到购物车（假设总额€100）
2. 点击"💳 结账"
3. 点击"💰 混合"按钮
4. **预期结果**：
   - 显示混合支付输入框（蓝色背景）
   - 自动填充现金和刷卡金额（各50%）
   - 现金金额：€50.00
   - 刷卡金额：€50.00

5. 修改金额测试：
   - 将现金改为€40
   - 将刷卡改为€50
   - **预期结果**：显示红色警告"⚠️ 支付总额 €90.00 与订单总额 €100.00 不符"

6. 修正金额：
   - 将现金改为€60
   - 将刷卡改为€40
   - **预期结果**：警告消失

7. 点击"✅ 确认支付"
8. **预期结果**：销售成功

### 步骤 9：测试客户信息

1. 添加产品到购物车
2. 点击"💳 结账"
3. 在"客户电话"输入框输入：0851234567
4. 选择支付方式并完成支付
5. **预期结果**：销售成功（客户信息已保存）

### 步骤 10：验证库存减少

1. 完成销售后，切换到"我的库存"标签
2. 查找刚才销售的产品
3. **预期结果**：
   - 库存数量已减少
   - 减少的数量 = 销售的数量

### 步骤 11：查看销售记录

1. 在"销售业务"标签页向下滚动
2. 找到"销售记录查询"部分
3. 选择日期范围（今天）
4. 点击"查询销售记录"
5. **预期结果**：
   - 显示刚才的销售记录
   - 包含产品、数量、金额、支付方式等信息

## 测试场景

### 场景 A：配件批量销售
```
1. 添加 Type-C Cable 1M × 3
2. 添加 Lightning Cable 2M × 2
3. 添加 USB-A to USB-C × 1
4. 总计：6 件商品
5. 现金支付
6. 验证库存减少
```

### 场景 B：混合支付
```
1. 添加产品，总额€85.50
2. 选择混合支付
3. 现金：€50.00
4. 刷卡：€35.50
5. 完成支付
6. 验证支付记录
```

### 场景 C：清空购物车
```
1. 添加多个产品到购物车
2. 点击"清空"按钮
3. 确认清空
4. 验证购物车为空
```

## 常见问题

**Q: 购物车摘要不显示？**
A: 购物车为空时不显示，添加产品后会自动显示。

**Q: 混合支付金额不匹配怎么办？**
A: 系统会显示红色警告，调整金额直到总额匹配。

**Q: 如何区分设备和配件？**
A: 有序列号/IMEI的是设备（显示"选择设备"按钮），其他是配件（显示"加入购物车"按钮）。

**Q: 销售后库存没有减少？**
A: 检查浏览器控制台是否有错误，或刷新页面重新查看。

**Q: 可以取消已完成的销售吗？**
A: 当前版本不支持，未来会添加退货/退款功能。

## 技术验证

### 检查销售记录（数据库）
```javascript
// 在MongoDB中查询
db.merchantsales.find({ merchantId: "merchant_001" }).sort({ saleDate: -1 }).limit(5)
```

### 检查库存变化
```javascript
// 在MongoDB中查询
db.merchantinventories.find({ merchantId: "merchant_001" })
```

## 性能指标

- 分类加载时间：< 1秒
- 产品列表加载：< 1秒
- 添加到购物车：即时响应
- 结账处理：< 2秒

## 相关文档
- [商户销售业务功能说明](./MERCHANT_SALES_CART_FEATURE.md)
- [商户库存管理](./MERCHANT_INVENTORY_FEATURES.md)
