# 立即测试：群组库存变体选择功能

## 🎯 测试目标
验证群组库存页面的变体选择功能是否正常工作

## 📋 准备工作
1. 确保服务器正在运行（http://localhost:3000）
2. 清除浏览器缓存或使用 Ctrl+F5 强制刷新
3. 准备测试账号：
   - MurrayRanelagh / 密码
   - MurrayDundrum / 密码

## 🧪 测试步骤

### 测试 1: 验证页面版本
1. 打开浏览器控制台（F12）
2. 登录 MurrayRanelagh 账号
3. 查看控制台输出
4. ✅ 应该看到：`✅ 页面版本: v2.1.3 - 修复群组库存变体选择功能`

### 测试 2: 选择店铺并查看目标店铺显示
1. 点击"群组库存"标签
2. 选择一个店铺（如 MurrayDundrum）
3. 查看右侧购物车区域
4. ✅ 应该看到：
   - 蓝色背景的"目标店铺"信息框
   - 显示选择的店铺名称（MurrayDundrum）

### 测试 3: 选择有变体的产品
1. 在分类列表中选择一个分类（如"手机"）
2. 找到显示"📱 可选变体"的产品卡片
3. 查看变体信息：
   - 型号列表
   - 颜色列表
   - 总库存数量
   - 价格范围
4. ✅ 产品卡片应该显示完整的变体信息

### 测试 4: 打开变体选择模态框
1. 点击"🎨 选择型号和颜色"按钮
2. ✅ 应该弹出模态框，显示：
   - 产品名称和品牌
   - 所有可选变体列表
   - 每个变体的型号、颜色、库存、价格
   - 税务分类标签（如果是公司间销售）

### 测试 5: 选择变体（设备类型）
**如果产品有序列号/IMEI（如手机）**:
1. 在模态框中点击一个变体
2. ✅ 应该：
   - 模态框关闭
   - 显示成功提示（包含产品名称和序列号）
   - 产品出现在右侧"调货清单"中
   - 购物车计数器更新（红色数字）
   - 显示序列号/IMEI
   - 数量固定为 1 台（不能修改）

### 测试 6: 选择变体（配件类型）
**如果产品没有序列号（如数据线、手机壳）**:
1. 在模态框中点击一个变体
2. ✅ 应该：
   - 弹出数量输入框
   - 显示可用库存数量
3. 输入数量（如 5）
4. ✅ 应该：
   - 模态框关闭
   - 显示成功提示
   - 产品出现在购物车中
   - 显示输入的数量
   - 可以使用 +/- 按钮调整数量

### 测试 7: 购物车功能
1. 添加多个产品到购物车
2. 验证购物车显示：
   - ✅ 产品名称
   - ✅ 商户ID
   - ✅ 序列号/IMEI（如果有）
   - ✅ 成色（如果有）
   - ✅ 数量和价格
   - ✅ 小计金额
   - ✅ 总计金额（使用批发价）
3. 测试数量调整（配件）：
   - ✅ 点击 + 按钮增加数量
   - ✅ 点击 - 按钮减少数量
   - ✅ 不能超过最大库存
   - ✅ 不能少于 1
4. 测试移除产品：
   - ✅ 点击"移除"按钮
   - ✅ 产品从购物车中删除
   - ✅ 总计金额更新

### 测试 8: 无变体产品
1. 找到没有变体的产品（简洁卡片，没有"可选变体"标签）
2. 点击"🛒 加入调货清单"按钮
3. ✅ 应该：
   - 根据产品类型正确处理（设备或配件）
   - 成功添加到购物车

### 测试 9: 返回店铺选择
1. 确保购物车中有产品
2. 点击"← 返回店铺选择"按钮
3. ✅ 应该：
   - 弹出确认对话框："返回店铺选择将清空当前调货清单，确定要继续吗？"
4. 点击"取消"
   - ✅ 保持在当前页面，购物车不变
5. 再次点击"← 返回店铺选择"，点击"确定"
   - ✅ 返回店铺选择页面
   - ✅ 购物车清空
   - ✅ 目标店铺信息隐藏

### 测试 10: 清空购物车
1. 添加一些产品到购物车
2. 点击"清空清单"按钮
3. ✅ 应该：
   - 弹出确认对话框
   - 点击确定后购物车清空
   - 显示"调货清单是空的"

### 测试 11: 提交调货申请（可选）
1. 添加产品到购物车
2. 点击"提交调货申请"按钮
3. ✅ 应该：
   - 弹出调货确认对话框
   - 显示交易类型（内部调拨或公司间销售）
   - 显示调出方和调入方公司信息
   - 显示产品清单
   - 显示金额汇总（小计、VAT、总计）
   - 可以输入备注
4. 点击"确认调货"或"确认购买"
5. ✅ 应该：
   - 提交成功
   - 显示调货单号
   - 购物车中的产品被移除
   - 显示成功消息

## 🐛 常见问题

### 问题 1: 点击变体后没有反应
**检查**:
- 打开浏览器控制台，查看是否有错误
- 确认页面版本是 v2.1.3
- 清除浏览器缓存后重试

### 问题 2: 购物车不显示目标店铺
**检查**:
- 确认已选择店铺
- 查看 `transferCartTargetStore` 元素的 display 样式
- 检查控制台是否有错误

### 问题 3: 无法添加到购物车
**检查**:
- 确认 transfer-cart.js 文件已加载
- 打开控制台，输入 `typeof addDeviceToTransferCart` 应该返回 "function"
- 检查产品数据是否完整（_id, productName, wholesalePrice 等）

### 问题 4: 数量调整不工作
**检查**:
- 只有配件（无序列号）才能调整数量
- 设备（有序列号/IMEI）数量固定为 1
- 不能超过最大库存数量

## ✅ 测试通过标准
- [ ] 页面版本正确（v2.1.3）
- [ ] 目标店铺信息正确显示
- [ ] 变体选择模态框正常打开和关闭
- [ ] 设备类型产品正确添加（数量固定为1）
- [ ] 配件类型产品可以选择数量
- [ ] 购物车显示完整信息
- [ ] 数量调整功能正常
- [ ] 移除产品功能正常
- [ ] 清空购物车功能正常
- [ ] 返回店铺选择时正确处理购物车
- [ ] 无变体产品正确添加

## 📝 测试结果记录
测试日期：__________
测试人员：__________

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 页面版本 | ⬜ 通过 ⬜ 失败 | |
| 目标店铺显示 | ⬜ 通过 ⬜ 失败 | |
| 变体选择模态框 | ⬜ 通过 ⬜ 失败 | |
| 设备添加 | ⬜ 通过 ⬜ 失败 | |
| 配件添加 | ⬜ 通过 ⬜ 失败 | |
| 购物车功能 | ⬜ 通过 ⬜ 失败 | |
| 数量调整 | ⬜ 通过 ⬜ 失败 | |
| 清空购物车 | ⬜ 通过 ⬜ 失败 | |
| 返回店铺选择 | ⬜ 通过 ⬜ 失败 | |
| 提交调货申请 | ⬜ 通过 ⬜ 失败 | |

## 🎉 完成
如果所有测试通过，群组库存变体选择功能已经完全修复！
