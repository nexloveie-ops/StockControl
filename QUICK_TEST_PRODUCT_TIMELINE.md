# 快速测试：产品时间线功能

## 测试环境
- 服务器地址: http://localhost:3000
- 测试账号: merchant_001 / merchant123

## 测试步骤

### 第一步：登录系统
1. 打开浏览器访问 http://localhost:3000
2. 使用商户账号登录：
   - 用户名: `merchant_001`
   - 密码: `merchant123`

### 第二步：进入我的库存
1. 登录后自动进入商户页面
2. 点击顶部导航栏的"我的库存"标签

### 第三步：搜索产品
1. 在搜索框中输入产品信息：
   - 可以搜索产品名称
   - 可以搜索序列号（如：111222）
   - 可以搜索条码
   - 可以搜索备注

2. 搜索结果会显示所有匹配的产品
   - 有库存的产品：正常显示
   - 零库存的产品：黄色背景，显示"已售完"标记

### 第四步：查看产品时间线
1. 点击搜索结果中的任意产品行
2. 弹出产品时间线模态框
3. 查看产品的历史记录

### 第五步：验证时间线内容

#### 应该看到的信息：

**📥 产品入库**
- 入库时间
- 来源（仓库调货/商户调货/手动入库）
- 成本价
- 零售价
- 数量

**💰 产品销售**（如果产品已销售）
- 销售时间
- 销售价格
- 数量
- 支付方式
- 客户电话（如有）

**📤 调货出库**（如果产品被调出）
- 调货时间
- 调货单号
- 调入商户
- 调货数量和价格

**📥 调货入库**（如果产品是调入的）
- 调货时间
- 调货单号
- 调出商户
- 调货价格

### 第六步：关闭时间线
1. 点击右上角的 × 按钮
2. 或点击底部的"关闭"按钮

## 测试场景

### 场景1：查看新入库产品
```
1. 搜索最近手动入库的产品
2. 点击查看时间线
3. 应该只看到一条"产品入库"记录
4. 验证入库信息是否正确
```

### 场景2：查看已销售产品
```
1. 搜索一个已经销售的产品
2. 点击查看时间线
3. 应该看到：
   - 产品入库记录
   - 产品销售记录
4. 验证销售信息是否正确
```

### 场景3：查看零库存产品
```
1. 在搜索框输入 "111222"
2. 应该能搜索到零库存产品（黄色背景）
3. 点击该产品查看时间线
4. 验证历史记录完整显示
```

### 场景4：查看调货产品
```
1. 搜索通过调货入库的产品
2. 点击查看时间线
3. 应该看到调货入库记录
4. 验证调货信息是否正确
```

## 预期结果

### ✅ 正确的表现
- 点击产品行后立即弹出模态框
- 显示"加载中..."提示
- 时间线按时间倒序排列（最新的在上面）
- 不同事件类型有不同颜色标记
- 最新事件有阴影高亮
- 时间格式正确（年-月-日 时:分）
- 详细信息完整显示

### ❌ 需要注意的问题
- 如果点击后没有反应 → 检查浏览器控制台错误
- 如果显示"加载失败" → 检查后端API是否正常
- 如果时间线为空 → 检查产品是否有历史记录
- 如果某些记录缺失 → 检查数据库关联数据

## 浏览器控制台检查

### 打开控制台
- Chrome/Edge: 按 F12
- Firefox: 按 F12
- Safari: Cmd+Option+I (Mac)

### 检查网络请求
1. 切换到 Network 标签
2. 点击产品查看时间线
3. 应该看到请求：
   ```
   GET /api/merchant/inventory/[ID]/timeline
   Status: 200 OK
   ```

### 检查响应数据
1. 点击该请求
2. 查看 Response 标签
3. 应该看到 JSON 格式的时间线数据：
   ```json
   {
     "success": true,
     "data": [...]
   }
   ```

## 常见问题排查

### 问题1：点击产品没有反应
**可能原因：**
- JavaScript 错误
- 函数未定义

**解决方法：**
1. 打开浏览器控制台
2. 查看是否有错误信息
3. 刷新页面重试

### 问题2：显示"加载失败"
**可能原因：**
- 后端 API 错误
- 网络连接问题
- 数据库查询失败

**解决方法：**
1. 检查服务器是否运行
2. 查看服务器控制台日志
3. 检查数据库连接

### 问题3：时间线为空
**可能原因：**
- 产品是新创建的，没有历史记录
- 数据库中缺少关联数据

**解决方法：**
1. 确认产品确实有历史记录
2. 检查数据库中的相关表
3. 尝试查看其他产品

### 问题4：某些事件缺失
**可能原因：**
- 关联数据被删除
- 数据库查询条件不匹配

**解决方法：**
1. 检查数据库中的关联记录
2. 查看服务器日志
3. 验证数据完整性

## 测试数据准备

### 如果需要测试数据：

**1. 创建新产品**
```
- 进入"我的库存"
- 点击"手动入库"
- 填写产品信息并提交
```

**2. 销售产品**
```
- 进入"销售业务"
- 选择产品加入购物车
- 完成销售
```

**3. 调货产品**
```
- 进入"仓库订货"
- 选择产品申请调货
- 等待管理员审批
```

## 成功标准

测试通过的标准：
- ✅ 能够点击产品查看时间线
- ✅ 时间线模态框正确显示
- ✅ 入库记录正确显示
- ✅ 销售记录正确显示（如有）
- ✅ 调货记录正确显示（如有）
- ✅ 时间线按时间倒序排列
- ✅ 不同事件类型有不同颜色
- ✅ 能够正常关闭模态框
- ✅ 零库存产品也能查看时间线

## 下一步

测试完成后，可以继续测试其他功能：
- [维修业务测试](./QUICK_TEST_REPAIR_BUSINESS.md)
- [销售业务测试](./QUICK_TEST_SALES_CART.md)
- [税务继承测试](./QUICK_TEST_TAX_INHERITANCE.md)
