# 🧪 用户管理功能快速测试指南

## 📋 测试前准备

### 1. 确认服务器运行
```bash
# 服务器应该在运行
# 访问: http://localhost:3000
```

### 2. 确认文件已更新
- ✅ `app.js` - 后端API已添加
- ✅ `admin-user-management.js` - 前端JavaScript已创建
- ✅ `admin.html` - 已引用JavaScript文件和添加模态框

---

## 🧪 测试场景

### 场景1: 查看用户列表

#### 步骤
1. 打开浏览器访问: http://localhost:3000/admin.html
2. 使用管理员账号登录
3. 点击"👥 用户管理"标签
4. 查看用户列表

#### 预期结果
- ✅ 显示所有用户
- ✅ 显示用户名、邮箱、角色、状态等信息
- ✅ 每个用户有"编辑"和"停用"按钮

---

### 场景2: 创建管理员用户

#### 步骤
1. 在用户管理页面，点击"➕ 添加用户"按钮
2. 填写用户信息：
   - **用户名**: admin2
   - **邮箱**: admin2@example.com
   - **密码**: 123456
   - **角色**: 管理员
   - **名字**: Admin
   - **姓氏**: User
   - **电话**: 1234567890
3. 确保"账户激活"已勾选
4. 点击"保存"按钮

#### 预期结果
- ✅ 显示"保存成功"或"用户创建成功"消息
- ✅ 模态框自动关闭
- ✅ 用户列表自动刷新
- ✅ 新用户出现在列表中

---

### 场景3: 创建仓库管理员

#### 步骤
1. 点击"➕ 添加用户"
2. 填写用户信息：
   - **用户名**: warehouse1
   - **邮箱**: warehouse1@example.com
   - **密码**: 123456
   - **角色**: 仓库管理员
3. 点击"保存"

#### 预期结果
- ✅ 用户创建成功
- ✅ 角色显示为"仓库管理员"徽章（黄色）

---

### 场景4: 创建普通用户（无群组）

#### 步骤
1. 点击"➕ 添加用户"
2. 填写用户信息：
   - **用户名**: retail1
   - **邮箱**: retail1@example.com
   - **密码**: 123456
   - **角色**: 普通用户
3. 选择角色后，观察"群组设置"区域出现
4. 保持"所属群组"为"无群组（独立用户）"
5. 点击"保存"

#### 预期结果
- ✅ "群组设置"区域自动显示
- ✅ 用户创建成功
- ✅ 角色显示为"普通用户"徽章（蓝色）
- ✅ 所属群组显示为"-"

---

### 场景5: 编辑用户

#### 步骤
1. 在用户列表中找到刚创建的用户
2. 点击"编辑"按钮
3. 修改用户信息：
   - 修改电话号码
   - 修改名字
4. 点击"保存"

#### 预期结果
- ✅ 模态框显示用户当前信息
- ✅ 密码框为空（编辑时不显示密码）
- ✅ 保存成功
- ✅ 用户列表中的信息已更新

---

### 场景6: 修改用户密码

#### 步骤
1. 编辑一个用户
2. 在密码框中输入新密码: newpassword123
3. 点击"保存"

#### 预期结果
- ✅ 保存成功
- ✅ 用户可以使用新密码登录

---

### 场景7: 停用用户

#### 步骤
1. 在用户列表中找到一个用户
2. 点击"停用"按钮
3. 确认停用操作

#### 预期结果
- ✅ 显示确认对话框
- ✅ 确认后显示"用户已停用"消息
- ✅ 用户状态变为"停用"徽章（红色）
- ✅ 按钮文字变为"启用"

---

### 场景8: 用户筛选

#### 步骤
1. 在用户管理页面，使用筛选器：
   - 选择"角色筛选" = "管理员"
   - 观察列表只显示管理员用户
2. 选择"状态筛选" = "活跃"
   - 观察列表只显示活跃用户
3. 清空筛选器（选择"全部"）

#### 预期结果
- ✅ 筛选器工作正常
- ✅ 列表实时更新
- ✅ 可以组合多个筛选条件

---

### 场景9: 用户搜索

#### 步骤
1. 在搜索框中输入用户名的一部分（例如："admin"）
2. 观察列表变化
3. 清空搜索框

#### 预期结果
- ✅ 列表实时过滤
- ✅ 显示匹配的用户
- ✅ 清空后显示所有用户

---

## ❌ 常见错误及解决方案

### 错误1: 点击"添加用户"没有反应
**原因**: 模态框HTML未添加或JavaScript文件未加载
**解决**: 
1. 检查admin.html是否引用了admin-user-management.js
2. 检查是否添加了userModal的HTML代码
3. 打开浏览器控制台查看错误信息

### 错误2: 保存用户时提示"用户名或邮箱已存在"
**原因**: 数据库中已有相同用户名或邮箱的用户
**解决**: 使用不同的用户名和邮箱

### 错误3: 保存失败，提示HTTP 500错误
**原因**: 后端API错误或数据库连接问题
**解决**: 
1. 检查服务器控制台的错误信息
2. 确认MongoDB连接正常
3. 检查app.js中的API代码是否正确添加

### 错误4: 用户列表显示"加载失败"
**原因**: API请求失败
**解决**: 
1. 检查服务器是否运行
2. 检查API路径是否正确（/api/admin/users）
3. 打开浏览器Network标签查看请求详情

---

## 🔍 调试技巧

### 1. 打开浏览器开发者工具
- 按 F12 打开
- 切换到"Console"标签查看日志
- 切换到"Network"标签查看API请求

### 2. 查看API请求
- 在Network标签中筛选"Fetch/XHR"
- 查看请求URL、方法、状态码
- 查看请求和响应的数据

### 3. 查看服务器日志
- 在运行服务器的终端中查看输出
- 查找错误信息和堆栈跟踪

---

## 📊 测试检查清单

### 用户管理基本功能
- [ ] 可以查看用户列表
- [ ] 可以创建管理员用户
- [ ] 可以创建仓库管理员用户
- [ ] 可以创建普通用户
- [ ] 可以编辑用户信息
- [ ] 可以修改用户密码
- [ ] 可以停用用户
- [ ] 可以启用已停用的用户

### 筛选和搜索
- [ ] 角色筛选工作正常
- [ ] 状态筛选工作正常
- [ ] 搜索功能工作正常
- [ ] 可以组合多个筛选条件

### 数据验证
- [ ] 用户名必填验证
- [ ] 邮箱必填验证
- [ ] 邮箱格式验证
- [ ] 密码必填验证（创建时）
- [ ] 角色必填验证
- [ ] 重复用户名/邮箱验证

### UI/UX
- [ ] 模态框正常显示和关闭
- [ ] 表单重置正常
- [ ] 成功/错误消息正常显示
- [ ] 列表自动刷新
- [ ] 角色徽章颜色正确

---

## 📝 测试数据示例

### 管理员用户
```
用户名: admin_test
邮箱: admin_test@example.com
密码: Admin123!
角色: 管理员
名字: Test
姓氏: Admin
电话: 1234567890
```

### 仓库管理员
```
用户名: warehouse_test
邮箱: warehouse_test@example.com
密码: Warehouse123!
角色: 仓库管理员
名字: Test
姓氏: Warehouse
电话: 0987654321
```

### 普通用户
```
用户名: retail_test
邮箱: retail_test@example.com
密码: Retail123!
角色: 普通用户
名字: Test
姓氏: Retail
电话: 5555555555
所属群组: 无群组
```

---

## 🎯 下一步测试

完成用户管理测试后，可以继续测试：
1. 群组管理功能
2. 用户-群组关联
3. 群组成员管理

---

**创建时间**: 2026-02-03
**版本**: 1.0
**状态**: ✅ 准备测试
