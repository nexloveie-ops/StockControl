<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä»“ç®¡å‘˜é¡µé¢åŠŸèƒ½æµ‹è¯•</title>
</head>
<body>
  <h1>ä»“ç®¡å‘˜é¡µé¢åŠŸèƒ½æµ‹è¯•</h1>
  
  <div style="margin: 20px 0;">
    <h2>âœ… é—®é¢˜ä¿®å¤éªŒè¯</h2>
    <ul>
      <li><strong>é—®é¢˜1ï¼š</strong> åº“å­˜äº§å“ç®¡ç†ç‚¹å‡»åˆ†ç±»å¼¹çª—æ˜¾ç¤ºé”™è¯¯å’Œæ— æ³•å…³é—­
        <ul>
          <li>âœ… å·²ä¿®å¤åˆ†ç±»ç­›é€‰APIï¼Œç°åœ¨æ­£ç¡®è¿”å›å¯¹åº”åˆ†ç±»çš„äº§å“</li>
          <li>âœ… å·²ä¿®å¤å¼¹çª—å…³é—­åŠŸèƒ½ï¼Œä½¿ç”¨ä¸“ç”¨çš„closeCategoryModalå‡½æ•°</li>
          <li>âœ… æ·»åŠ äº†ç‚¹å‡»èƒŒæ™¯å…³é—­å¼¹çª—çš„åŠŸèƒ½</li>
          <li>âœ… æ·»åŠ äº†è°ƒè¯•æ—¥å¿—å¸®åŠ©æ’æŸ¥é—®é¢˜</li>
        </ul>
      </li>
      <li><strong>é—®é¢˜2ï¼š</strong> å‘ç¥¨ä¸Šä¼ å…¥åº“åŠŸèƒ½è¿›è´§ä»·è¯»å–å’Œç¨åŠ¡åˆ†ç±»é—®é¢˜
        <ul>
          <li>âœ… ä¿®å¤äº†è¿›è´§ä»·å­—æ®µè¯»å–ï¼Œæ”¯æŒpurchasePriceå’ŒcostPriceå­—æ®µ</li>
          <li>âœ… æ·»åŠ äº†ç¨åŠ¡åˆ†ç±»é€‰æ‹©æ¡†ï¼ˆVAT 23%, VAT 13.5%, VAT 0%ï¼‰</li>
          <li>âœ… å®ç°äº†æ ¹æ®äº§å“åˆ†ç±»è‡ªåŠ¨è®¾ç½®é»˜è®¤ç¨ç‡</li>
          <li>âœ… è¿›è´§ä»·å˜åŒ–æ—¶è‡ªåŠ¨è®¡ç®—æ‰¹å‘ä»·ï¼ˆè¿›è´§ä»· * 1.2ï¼‰</li>
          <li>âœ… äº§å“åˆ†ç±»å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°ç¨ç‡</li>
        </ul>
      </li>
      <li><strong>é—®é¢˜3ï¼š</strong> å…¥åº“ç®¡ç†éœ€è¦æ‰‹åŠ¨å½•å…¥åŠŸèƒ½
        <ul>
          <li>âœ… æ·»åŠ äº†å…¥åº“æ–¹å¼é€‰æ‹©ï¼ˆå‘ç¥¨ä¸Šä¼  / æ‰‹åŠ¨å½•å…¥ï¼‰</li>
          <li>âœ… å®ç°äº†å®Œæ•´çš„æ‰‹åŠ¨å½•å…¥ç•Œé¢</li>
          <li>âœ… æ”¯æŒä¾›åº”å•†é€‰æ‹©å’Œå‘ç¥¨å·ç è¾“å…¥</li>
          <li>âœ… åŠ¨æ€äº§å“è¡Œç®¡ç†ï¼ˆæ·»åŠ /åˆ é™¤äº§å“ï¼‰</li>
          <li>âœ… è®¾å¤‡äº§å“æ ¹æ®æ•°é‡ç”Ÿæˆå¤šä¸ªSN/IMEIè¾“å…¥æ¡†</li>
          <li>âœ… é…ä»¶äº§å“æ˜¾ç¤ºå•ä¸ªæ¡ç è¾“å…¥æ¡†ï¼ˆå¯é€‰ï¼‰</li>
          <li>âœ… å®Œæ•´çš„æ•°æ®éªŒè¯å’Œå…¥åº“ç¡®è®¤æµç¨‹</li>
        </ul>
      </li>
    </ul>
  </div>
  
  <div style="margin: 20px 0;">
    <h2>æµ‹è¯•é“¾æ¥</h2>
    <ul>
      <li><a href="/prototype-working.html" target="_blank">ğŸ  ä»“ç®¡å‘˜å·¥ä½œå° (prototype-working.html)</a></li>
      <li><a href="/admin.html" target="_blank">âš™ï¸ ç®¡ç†åå° (admin.html)</a></li>
      <li><a href="/login.html" target="_blank">ğŸ” ç™»å½•é¡µé¢ (æµ‹è¯•è·³è½¬)</a></li>
    </ul>
  </div>
  
  <div style="margin: 20px 0;">
    <h2>APIæµ‹è¯•</h2>
    <button onclick="testProductsAPI()">æµ‹è¯•äº§å“API</button>
    <button onclick="testCategoryFilter()">æµ‹è¯•åˆ†ç±»ç­›é€‰</button>
    <button onclick="testSearch()">æµ‹è¯•æœç´¢åŠŸèƒ½</button>
    <div id="apiResults" style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 5px;"></div>
  </div>
  
  <div style="margin: 20px 0;">
    <h2>æ•°æ®åº“çŠ¶æ€</h2>
    <button onclick="checkDatabaseStatus()">æ£€æŸ¥æ•°æ®åº“çŠ¶æ€</button>
    <div id="dbResults" style="margin-top: 10px; padding: 10px; background: #f0f8ff; border-radius: 5px;"></div>
  </div>

  <script>
    async function testProductsAPI() {
      try {
        const response = await fetch('/api/products');
        const result = await response.json();
        
        // ç»Ÿè®¡åˆ†ç±»
        const categories = {};
        result.data?.forEach(product => {
          const category = product.productType || 'æœªåˆ†ç±»';
          categories[category] = (categories[category] || 0) + 1;
        });
        
        document.getElementById('apiResults').innerHTML = `
          <h3>äº§å“APIæµ‹è¯•ç»“æœ:</h3>
          <p>çŠ¶æ€: ${result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}</p>
          <p>äº§å“æ•°é‡: ${result.data?.length || 0}</p>
          <h4>åˆ†ç±»ç»Ÿè®¡:</h4>
          <ul>
            ${Object.entries(categories).map(([cat, count]) => `<li>${cat}: ${count} ä¸ªäº§å“</li>`).join('')}
          </ul>
        `;
      } catch (error) {
        document.getElementById('apiResults').innerHTML = `
          <h3>äº§å“APIæµ‹è¯•ç»“æœ:</h3>
          <p>âŒ é”™è¯¯: ${error.message}</p>
        `;
      }
    }
    
    async function testCategoryFilter() {
      try {
        const response = await fetch('/api/products?category=æ‰‹æœºé…ä»¶');
        const result = await response.json();
        document.getElementById('apiResults').innerHTML = `
          <h3>åˆ†ç±»ç­›é€‰æµ‹è¯•ç»“æœ:</h3>
          <p>çŠ¶æ€: ${result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}</p>
          <p>æ‰‹æœºé…ä»¶äº§å“æ•°é‡: ${result.data?.length || 0}</p>
          <ul>
            ${(result.data || []).map(p => `<li>${p.name} (${p.productType})</li>`).join('')}
          </ul>
        `;
      } catch (error) {
        document.getElementById('apiResults').innerHTML = `
          <h3>åˆ†ç±»ç­›é€‰æµ‹è¯•ç»“æœ:</h3>
          <p>âŒ é”™è¯¯: ${error.message}</p>
        `;
      }
    }
    
    async function testSearch() {
      try {
        const response = await fetch('/api/products?search=iPhone');
        const result = await response.json();
        document.getElementById('apiResults').innerHTML = `
          <h3>æœç´¢åŠŸèƒ½æµ‹è¯•ç»“æœ:</h3>
          <p>çŠ¶æ€: ${result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}</p>
          <p>æœç´¢"iPhone"ç»“æœæ•°é‡: ${result.data?.length || 0}</p>
          <ul>
            ${(result.data || []).map(p => `<li>${p.name} (${p.productType})</li>`).join('')}
          </ul>
        `;
      } catch (error) {
        document.getElementById('apiResults').innerHTML = `
          <h3>æœç´¢åŠŸèƒ½æµ‹è¯•ç»“æœ:</h3>
          <p>âŒ é”™è¯¯: ${error.message}</p>
        `;
      }
    }
    
    async function checkDatabaseStatus() {
      try {
        const response = await fetch('/api/stats');
        const result = await response.json();
        document.getElementById('dbResults').innerHTML = `
          <h3>æ•°æ®åº“çŠ¶æ€:</h3>
          <p>çŠ¶æ€: ${result.success ? 'âœ… è¿æ¥æ­£å¸¸' : 'âŒ è¿æ¥å¤±è´¥'}</p>
          <p>æ€»äº§å“æ•°: ${result.data?.totalProducts || 0}</p>
          <p>å¯é”€å”®äº§å“: ${result.data?.availableProducts || 0}</p>
          <p>ä¾›åº”å•†æ•°é‡: ${result.data?.totalSuppliers || 0}</p>
        `;
      } catch (error) {
        document.getElementById('dbResults').innerHTML = `
          <h3>æ•°æ®åº“çŠ¶æ€:</h3>
          <p>âŒ é”™è¯¯: ${error.message}</p>
        `;
      }
    }
    
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
    window.onload = function() {
      testProductsAPI();
      checkDatabaseStatus();
    };
  </script>
</body>
</html>