# 🧪 管理员采购订单功能快速测试指南

## 📋 测试前准备

### 1. 确认服务器运行
```bash
# 服务器应该在运行
# 访问: http://localhost:3000
```

### 2. 确认数据库连接
- MongoDB Atlas 已连接
- 供应商数据已存在

---

## 🧪 测试场景

### 场景1: 发票上传入库（AI识别）

#### 步骤
1. 打开浏览器访问: http://localhost:3000/admin.html
2. 使用管理员账号登录
3. 点击"📦 采购订单"标签
4. 确保"📤 发票上传入库"按钮已选中（红色背景）
5. 点击"📤 上传发票图片"按钮
6. 选择一张发票图片（JPG/PNG/PDF格式）
7. 等待识别结果

#### 预期结果
- ✅ 不再显示"识别失败 HTTP 404"
- ✅ 显示"🔍 正在识别发票内容..."
- ✅ 识别完成后显示结果：
  - 识别到的产品数量
  - 供应商名称
  - 发票号码

#### 可能的结果

**情况A: OpenAI API密钥已配置**
- 使用真实的AI识别
- 识别准确度较高
- 可能需要等待几秒钟

**情况B: OpenAI API密钥未配置**
- 使用模拟数据
- 立即返回结果
- 显示示例产品数据

---

### 场景2: 手动录入入库

#### 步骤
1. 在管理员页面，点击"✏️ 手动录入入库"按钮
2. 选择供应商（下拉框）
3. 输入发票号码（例如: INV-2026-001）
4. 填写产品信息：
   - **产品名称**: iPhone 15 Pro Max
   - **数量**: 2
   - **进货价**: 800.00
   - **分类**: 全新设备
   - **颜色**: 深空黑
   - **成色**: 全新
5. 观察自动计算：
   - 批发价应该自动填充为: 960.00 (800 × 1.2)
   - 零售价应该自动填充为: 1248.00 (960 × 1.3)
   - 税务分类应该自动设置为: VAT 23%
6. 因为是"全新设备"，应该显示2个序列号输入框
7. 填写序列号：
   - SN/IMEI 1: 123456789012345
   - SN/IMEI 2: 123456789012346
8. 点击"✅ 确认入库"

#### 预期结果
- ✅ 不再显示"HTTP 404"错误
- ✅ 显示成功消息：
  ```
  ✅ 手动入库成功！
  
  创建产品: 2 个
  更新产品: 0 个
  ```
- ✅ 表单自动清空
- ✅ 统计数据自动刷新

---

## 🔍 调试技巧

### 1. 打开浏览器开发者工具
- 按 F12 打开
- 切换到"Console"标签
- 查看调试日志

### 2. 查看网络请求
- 切换到"Network"标签
- 筛选"Fetch/XHR"
- 查看API请求和响应

### 3. 常见调试日志

#### 发票上传
```
[Admin] 选择文件: invoice.jpg (image/jpeg)
[Admin] 识别结果: {success: true, data: {...}}
```

#### 手动录入
```
[Admin] 切换到手动录入模式
[Admin] 加载了 5 个供应商
[Admin] 添加手动录入产品行 0
[Admin] 更新手动产品 0 的 name: iPhone 15 Pro Max
[Admin] 更新手动产品 0 的 purchasePrice: 800
[Admin] 开始手动录入确认入库
[Admin] 发送手动入库数据: {...}
[Admin] 手动入库确认API响应: {success: true, ...}
```

---

## ❌ 常见错误及解决方案

### 错误1: HTTP 404
**原因**: API路径不正确
**解决**: 已修复，使用正确的路径 `/api/admin/recognize-invoice` 和 `/api/admin/receiving/confirm`

### 错误2: 请选择供应商
**原因**: 没有选择供应商
**解决**: 在供应商下拉框中选择一个供应商

### 错误3: 请输入发票号码
**原因**: 发票号码为空
**解决**: 在发票号码输入框中输入任意号码

### 错误4: 请输入产品名称
**原因**: 产品名称为空
**解决**: 填写产品名称

### 错误5: 请选择产品分类
**原因**: 没有选择产品分类
**解决**: 在分类下拉框中选择一个分类

### 错误6: 请输入有效的进货价
**原因**: 进货价为0或未填写
**解决**: 输入大于0的进货价

### 错误7: 需要填写序列号
**原因**: 设备类产品没有填写所有序列号
**解决**: 为每个设备填写序列号（数量与产品数量一致）

---

## 📊 测试检查清单

### 发票上传功能
- [ ] 可以点击上传按钮
- [ ] 可以选择图片文件
- [ ] 不再显示404错误
- [ ] 显示识别进度
- [ ] 显示识别结果

### 手动录入功能
- [ ] 可以切换到手动录入模式
- [ ] 供应商下拉框正常加载
- [ ] 可以添加产品行
- [ ] 进货价输入后自动计算批发价
- [ ] 批发价输入后自动计算零售价
- [ ] 选择分类后自动设置税率
- [ ] 设备类产品显示序列号输入框
- [ ] 配件类产品显示条码输入框
- [ ] 可以移除产品行
- [ ] 可以清空表单
- [ ] 确认入库不再显示404错误
- [ ] 入库成功后显示成功消息
- [ ] 表单自动清空

### 数据验证
- [ ] 空产品名称被拦截
- [ ] 未选择分类被拦截
- [ ] 无效进货价被拦截
- [ ] 设备类产品序列号不完整被拦截

---

## 🎯 测试数据示例

### 示例1: 手机配件
```
产品名称: iPhone 15 Pro Max 手机壳
数量: 10
进货价: 5.00
分类: 手机配件
颜色: 透明
成色: 全新
条码: 1234567890123
```

### 示例2: 全新设备
```
产品名称: iPhone 15 Pro Max 256GB
数量: 1
进货价: 800.00
分类: 全新设备
颜色: 深空黑
成色: 全新
序列号: 123456789012345
```

### 示例3: 二手设备
```
产品名称: iPhone 14 Pro 128GB
数量: 1
进货价: 500.00
分类: 二手设备
颜色: 金色
成色: 二手
序列号: 987654321098765
```

---

## 📝 测试报告模板

```
测试日期: 2026-02-03
测试人员: [你的名字]
服务器状态: ✅ 运行中
数据库状态: ✅ 已连接

测试结果:
- 发票上传功能: [ ] 通过 [ ] 失败
- 手动录入功能: [ ] 通过 [ ] 失败
- 价格自动计算: [ ] 通过 [ ] 失败
- 税率自动设置: [ ] 通过 [ ] 失败
- 序列号管理: [ ] 通过 [ ] 失败
- 数据验证: [ ] 通过 [ ] 失败

问题记录:
1. [如有问题，在此记录]
2. [如有问题，在此记录]

总体评价: [ ] 优秀 [ ] 良好 [ ] 需改进
```

---

**创建时间**: 2026-02-03
**版本**: 1.0
**状态**: ✅ 准备测试
