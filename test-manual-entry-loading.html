<!DOCTYPE html>
<html>
<head>
  <title>æµ‹è¯•æ‰‹åŠ¨å½•å…¥åŠ¨æ€åŠ è½½</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; }
    select { padding: 8px; margin: 10px 0; width: 300px; }
  </style>
</head>
<body>
  <h1>ğŸ§ª æµ‹è¯•æ‰‹åŠ¨å½•å…¥åŠ¨æ€åŠ è½½</h1>

  <div class="section">
    <h2>æ­¥éª¤ 1: åŠ è½½æ•°æ®</h2>
    <button onclick="loadData()">ğŸ”„ åŠ è½½åˆ†ç±»å’Œæˆè‰²æ•°æ®</button>
    <div id="loadStatus"></div>
  </div>

  <div class="section">
    <h2>æ­¥éª¤ 2: æŸ¥çœ‹æ•°æ®</h2>
    <h3>åˆ†ç±»æ•°æ®:</h3>
    <pre id="categoriesData">æœªåŠ è½½</pre>
    
    <h3>æˆè‰²æ•°æ®:</h3>
    <pre id="conditionsData">æœªåŠ è½½</pre>
  </div>

  <div class="section">
    <h2>æ­¥éª¤ 3: æµ‹è¯•ä¸‹æ‹‰æ¡†</h2>
    <button onclick="generateDropdowns()">ç”Ÿæˆä¸‹æ‹‰æ¡†</button>
    
    <div style="margin-top: 15px;">
      <label><strong>åˆ†ç±»ä¸‹æ‹‰æ¡†:</strong></label><br>
      <div id="categoryDropdown"></div>
    </div>
    
    <div style="margin-top: 15px;">
      <label><strong>æˆè‰²ä¸‹æ‹‰æ¡†:</strong></label><br>
      <div id="conditionDropdown"></div>
    </div>
  </div>

  <script>
    let categoriesData = [];
    let conditionsData = [];

    // åŠ è½½åˆ†ç±»
    async function loadCategories() {
      console.log('ğŸ”„ å¼€å§‹åŠ è½½äº§å“åˆ†ç±»æ•°æ®');
      try {
        const response = await fetch('/api/admin/categories');
        console.log('ğŸ“¥ åˆ†ç±»APIå“åº”:', response.status, response.statusText);
        
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        
        const result = await response.json();
        console.log('ğŸ“¦ åˆ†ç±»æ•°æ®:', result);
        console.log(`âœ… åˆ†ç±»æ•°é‡: ${result.data?.length || 0}`);
        
        return result.data || [];
      } catch (error) {
        console.error('âŒ åˆ†ç±»æ•°æ®åŠ è½½å¤±è´¥:', error);
        return [];
      }
    }

    // åŠ è½½æˆè‰²
    async function loadConditions() {
      console.log('ğŸ”„ å¼€å§‹åŠ è½½è®¾å¤‡æˆè‰²æ•°æ®');
      try {
        const response = await fetch('/api/admin/conditions');
        console.log('ğŸ“¥ æˆè‰²APIå“åº”:', response.status, response.statusText);
        
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        
        const result = await response.json();
        console.log('ğŸ“¦ æˆè‰²æ•°æ®:', result);
        console.log(`âœ… æˆè‰²æ•°é‡: ${result.data?.length || 0}`);
        
        return result.data || [];
      } catch (error) {
        console.error('âŒ æˆè‰²æ•°æ®åŠ è½½å¤±è´¥:', error);
        return [];
      }
    }

    // åŠ è½½æ•°æ®
    async function loadData() {
      const statusDiv = document.getElementById('loadStatus');
      statusDiv.innerHTML = '<p>â³ æ­£åœ¨åŠ è½½...</p>';
      
      try {
        categoriesData = await loadCategories();
        conditionsData = await loadConditions();
        
        document.getElementById('categoriesData').textContent = JSON.stringify(categoriesData, null, 2);
        document.getElementById('conditionsData').textContent = JSON.stringify(conditionsData, null, 2);
        
        statusDiv.innerHTML = `
          <p style="color: green;">âœ… åŠ è½½æˆåŠŸ!</p>
          <p>åˆ†ç±»æ•°é‡: ${categoriesData.length}</p>
          <p>æˆè‰²æ•°é‡: ${conditionsData.length}</p>
        `;
      } catch (error) {
        statusDiv.innerHTML = `<p style="color: red;">âŒ åŠ è½½å¤±è´¥: ${error.message}</p>`;
      }
    }

    // ç”Ÿæˆåˆ†ç±»é€‰é¡¹
    function generateCategoryOptions(categories, selectedType) {
      if (!categories || categories.length === 0) {
        return `
          <option value="">æ²¡æœ‰æ•°æ® - ä½¿ç”¨é»˜è®¤é€‰é¡¹</option>
          <option value="æ‰‹æœºé…ä»¶">æ‰‹æœºé…ä»¶</option>
          <option value="ç”µè„‘é…ä»¶">ç”µè„‘é…ä»¶</option>
        `;
      }
      
      let html = '<option value="">é€‰æ‹©åˆ†ç±»...</option>';
      html += categories
        .filter(cat => cat.isActive)
        .sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0))
        .map(cat => `<option value="${cat.type}">${cat.type}</option>`)
        .join('');
      return html;
    }

    // ç”Ÿæˆæˆè‰²é€‰é¡¹
    function generateConditionOptions(conditions, selectedCondition) {
      if (!conditions || conditions.length === 0) {
        return `
          <option value="">æ²¡æœ‰æ•°æ® - ä½¿ç”¨é»˜è®¤é€‰é¡¹</option>
          <option value="Brand New">å…¨æ–°</option>
          <option value="Pre-Owned">äºŒæ‰‹</option>
        `;
      }
      
      return conditions
        .filter(cond => cond.isActive)
        .sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0))
        .map(cond => `<option value="${cond.code}">${cond.name}</option>`)
        .join('');
    }

    // ç”Ÿæˆä¸‹æ‹‰æ¡†
    function generateDropdowns() {
      const categoryHtml = `<select>${generateCategoryOptions(categoriesData, '')}</select>`;
      const conditionHtml = `<select>${generateConditionOptions(conditionsData, '')}</select>`;
      
      document.getElementById('categoryDropdown').innerHTML = categoryHtml;
      document.getElementById('conditionDropdown').innerHTML = conditionHtml;
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
    window.onload = function() {
      console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ');
      loadData();
    };
  </script>
</body>
</html>
